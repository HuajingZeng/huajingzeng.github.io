<!doctype html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=11,IE=10,IE=9,IE=8">
    <meta name="baidu-site-verification" content="dIcXMeY8Ya">
    
    <title>iOS知识小集 | 曾华经</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <meta name="keywords" content="iOS, Web">
    <meta name="description" content="曾华经个人博客">

    
    <link rel="alternative" href="/atom.xml" title="曾华经" type="application/atom+xml">
    
    
    <link rel="shortcut icon" href="/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.css">
    <!--[if lt IE 9]>
    <script src="/js/html5.js"></script>
    <![endif]-->
    
<script>
    var _hmt = _hmt || [];
	(function() {
  		var hm = document.createElement("script");
  		hm.src = "https://hm.baidu.com/hm.js?8dcd7371cdcc3e343c29794b5e207954";
  		var s = document.getElementsByTagName("script")[0]; 
  		s.parentNode.insertBefore(hm, s);
	})();
</script>


	<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
</html>
<body class="home">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!--[if lt IE 9]>
    <div class="browsehappy">
        当前网页 <strong>不支持</strong>
        你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/">升级你的浏览器</a>.
    </div>
    <![endif]-->

    <!-- 博客头部 -->
    <header class="header">
    <section class="container header-main">
        <div class="logo">
            <a href="/">
                <div class="cover">
                    <span class="name">曾华经</span>
                    <span class="description">iOS Programmer</span>
                </div>
            </a>
        </div>
        <div class="dropnav icon-paragraph-justify" id="JELON__btnDropNav"></div>
        <ul class="menu hidden" id="JELON__menu">
            
            <li rel="/post/iOS知识小集/index.html" class="item ">
                <a href="/" title="首页" class="icon-home">&nbsp;首页</a>
            </li>
            
            <li rel="/post/iOS知识小集/index.html" class="item ">
                <a href="/lab/" title="项目" class="icon-lab">&nbsp;项目</a>
            </li>
            
            <li rel="/post/iOS知识小集/index.html" class="item ">
                <a href="/about/" title="关于" class="icon-about">&nbsp;关于</a>
            </li>
            
            <li rel="/post/iOS知识小集/index.html" class="item ">
                <a href="/comment/" title="留言" class="icon-comment">&nbsp;留言</a>
            </li>
            
        </ul>
        <div class="profile clearfix">
            <div class="feeds fl">
                
                
                <p class="links">
                    
                        <a href="https://github.com/HuajingZeng" target="_blank">Github</a>
                        |
                    
                        <a href="https://github.com" target="_blank">Hosted by Github Pages</a>
                        
                    
                </p>
                <p class="sns">
                    
                        <a href="https://weibo.com/p/1005051288040665/home?from=page_100505&amp;mod=TAB#place" class="sinaweibo" target="_blank"><b>■</b> 新浪微博</a>
                    
                        <a href class="qqweibo" target="_blank"><b>■</b> Facebook</a>
                    
                    <a href="javascript: void(0);" class="wechat">
                        <b>■</b>
                        公众号
                        <span class="popover">
                            <img src="/img/wechat_mp.jpg" width="120" height="120" alt="我的微信订阅号">
                            <i class="arrow"></i>
                        </span>
                    </a>
                </p>
                
            </div>
            <div class="avatar fr">
                <img src="/img/zhj.jpg" alt="avatar" title="曾华经">
            </div>
        </div>
    </section>
</header>


    <!-- 博客正文 -->
    <div class="container body clearfix">
        <section class="content">
            <div class="content-main widget">
                <!-- 文章页 -->
<!-- 目录内容 -->

    <p class="show-toc-btn" id="show-toc-btn" onclick="showToc();" style="display:block">
    <span class="btn-text">文章导航</span>
    </p>
    <div id="toc-article" class="toc-article" style="display:none">
        <span id="toc-close" class="toc-close" title="隐藏导航" onclick="showBtn();">×</span>
        <strong class="toc-title">文章目录</strong>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#UI视图"><span class="toc-number">1.</span> <span class="toc-text">UI视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#事件传递机制"><span class="toc-number">1.1.</span> <span class="toc-text">事件传递机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UIView和CALayer"><span class="toc-number">1.1.1.</span> <span class="toc-text">UIView和CALayer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事件传递"><span class="toc-number">1.1.2.</span> <span class="toc-text">事件传递</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UI绘制原理"><span class="toc-number">1.2.</span> <span class="toc-text">UI绘制原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#图像显示原理"><span class="toc-number">1.2.1.</span> <span class="toc-text">图像显示原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CPU工作"><span class="toc-number">1.2.2.</span> <span class="toc-text">CPU工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GPU渲染管线"><span class="toc-number">1.2.3.</span> <span class="toc-text">GPU渲染管线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UI卡顿、掉帧的原因"><span class="toc-number">1.2.4.</span> <span class="toc-text">UI卡顿、掉帧的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#滑动优化方案"><span class="toc-number">1.2.5.</span> <span class="toc-text">滑动优化方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UIView绘制原理"><span class="toc-number">1.2.6.</span> <span class="toc-text">UIView绘制原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#异步绘制原理"><span class="toc-number">1.3.</span> <span class="toc-text">异步绘制原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#离屏渲染"><span class="toc-number">1.4.</span> <span class="toc-text">离屏渲染</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OC语言"><span class="toc-number">2.</span> <span class="toc-text">OC语言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#分类（Category）"><span class="toc-number">2.1.</span> <span class="toc-text">分类（Category）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特点"><span class="toc-number">2.1.1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#可以添加的内容"><span class="toc-number">2.1.2.</span> <span class="toc-text">可以添加的内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加载调用栈"><span class="toc-number">2.1.3.</span> <span class="toc-text">加载调用栈</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关联对象"><span class="toc-number">2.2.</span> <span class="toc-text">关联对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#关联对象的本质"><span class="toc-number">2.2.1.</span> <span class="toc-text">关联对象的本质</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#扩展"><span class="toc-number">2.3.</span> <span class="toc-text">扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特点-1"><span class="toc-number">2.3.1.</span> <span class="toc-text">特点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代理"><span class="toc-number">2.4.</span> <span class="toc-text">代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通知"><span class="toc-number">2.5.</span> <span class="toc-text">通知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KVO"><span class="toc-number">2.6.</span> <span class="toc-text">KVO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#触发条件"><span class="toc-number">2.6.1.</span> <span class="toc-text">触发条件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KVC"><span class="toc-number">2.7.</span> <span class="toc-text">KVC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Accessor-Method"><span class="toc-number">2.7.1.</span> <span class="toc-text">Accessor Method</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Instance-var"><span class="toc-number">2.7.2.</span> <span class="toc-text">Instance var</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#属性关键字"><span class="toc-number">2.8.</span> <span class="toc-text">属性关键字</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#assign"><span class="toc-number">2.8.1.</span> <span class="toc-text">assign</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#weak"><span class="toc-number">2.8.2.</span> <span class="toc-text">weak</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy"><span class="toc-number">2.8.3.</span> <span class="toc-text">copy</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Runtime"><span class="toc-number">3.</span> <span class="toc-text">Runtime</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据结构"><span class="toc-number">3.1.</span> <span class="toc-text">数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#objc-object"><span class="toc-number">3.1.1.</span> <span class="toc-text">objc_object</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#objc-class"><span class="toc-number">3.1.2.</span> <span class="toc-text">objc_class</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#isa指针"><span class="toc-number">3.1.3.</span> <span class="toc-text">isa指针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cache-t"><span class="toc-number">3.1.4.</span> <span class="toc-text">cache_t</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#class-data-bits-t"><span class="toc-number">3.1.5.</span> <span class="toc-text">class_data_bits_t</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#method-t"><span class="toc-number">3.1.6.</span> <span class="toc-text">method_t</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Objective-C对象数据结构"><span class="toc-number">3.1.7.</span> <span class="toc-text">Objective-C对象数据结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对象、类对象、元类对象"><span class="toc-number">3.2.</span> <span class="toc-text">对象、类对象、元类对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#消息传递机制"><span class="toc-number">3.3.</span> <span class="toc-text">消息传递机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#缓存查找"><span class="toc-number">3.3.1.</span> <span class="toc-text">缓存查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#当前类中查找"><span class="toc-number">3.3.2.</span> <span class="toc-text">当前类中查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#父类逐级查找"><span class="toc-number">3.3.3.</span> <span class="toc-text">父类逐级查找</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#消息转发机制"><span class="toc-number">3.4.</span> <span class="toc-text">消息转发机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Method-Swizzling"><span class="toc-number">3.5.</span> <span class="toc-text">Method-Swizzling</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态方法解析"><span class="toc-number">3.6.</span> <span class="toc-text">动态方法解析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#内存"><span class="toc-number">4.</span> <span class="toc-text">内存</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#内存管理方案"><span class="toc-number">4.1.</span> <span class="toc-text">内存管理方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#arm64架构"><span class="toc-number">4.1.1.</span> <span class="toc-text">arm64架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#散列表方式"><span class="toc-number">4.1.2.</span> <span class="toc-text">散列表方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hash查找"><span class="toc-number">4.1.3.</span> <span class="toc-text">Hash查找</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自旋锁"><span class="toc-number">4.2.</span> <span class="toc-text">自旋锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#引用技术表"><span class="toc-number">4.3.</span> <span class="toc-text">引用技术表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RefcountMap"><span class="toc-number">4.3.1.</span> <span class="toc-text">RefcountMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#size-t"><span class="toc-number">4.3.2.</span> <span class="toc-text">size_t</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#弱引用表"><span class="toc-number">4.4.</span> <span class="toc-text">弱引用表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#weak-table-t"><span class="toc-number">4.4.1.</span> <span class="toc-text">weak_table_t</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ARC、MRC"><span class="toc-number">4.5.</span> <span class="toc-text">ARC、MRC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MRC"><span class="toc-number">4.5.1.</span> <span class="toc-text">MRC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ARC"><span class="toc-number">4.5.2.</span> <span class="toc-text">ARC</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#引用计数管理"><span class="toc-number">4.6.</span> <span class="toc-text">引用计数管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#alloc实现"><span class="toc-number">4.6.1.</span> <span class="toc-text">alloc实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#retain实现"><span class="toc-number">4.6.2.</span> <span class="toc-text">retain实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#release实现"><span class="toc-number">4.6.3.</span> <span class="toc-text">release实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#retainCount实现"><span class="toc-number">4.6.4.</span> <span class="toc-text">retainCount实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dealloc实现"><span class="toc-number">4.6.5.</span> <span class="toc-text">dealloc实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#弱引用管理"><span class="toc-number">4.7.</span> <span class="toc-text">弱引用管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自动释放池"><span class="toc-number">4.8.</span> <span class="toc-text">自动释放池</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AutoreleasePoolPage"><span class="toc-number">4.8.1.</span> <span class="toc-text">AutoreleasePoolPage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AutoreleasePoolPage-push"><span class="toc-number">4.8.2.</span> <span class="toc-text">AutoreleasePoolPage::push</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#autorelease"><span class="toc-number">4.8.3.</span> <span class="toc-text">autorelease</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AutoreleasePoolPage-pop"><span class="toc-number">4.8.4.</span> <span class="toc-text">AutoreleasePoolPage::pop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#autoreleasepool总结"><span class="toc-number">4.8.5.</span> <span class="toc-text">@autoreleasepool总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#循环引用"><span class="toc-number">4.9.</span> <span class="toc-text">循环引用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#种类"><span class="toc-number">4.9.1.</span> <span class="toc-text">种类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#来源"><span class="toc-number">4.9.2.</span> <span class="toc-text">来源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#破解"><span class="toc-number">4.9.3.</span> <span class="toc-text">破解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#示例"><span class="toc-number">4.9.4.</span> <span class="toc-text">示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Block"><span class="toc-number">5.</span> <span class="toc-text">Block</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#截获变量"><span class="toc-number">5.1.</span> <span class="toc-text">截获变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#block修饰符"><span class="toc-number">5.2.</span> <span class="toc-text">__block修饰符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Block的内存管理"><span class="toc-number">5.3.</span> <span class="toc-text">Block的内存管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Block的循环引用"><span class="toc-number">5.4.</span> <span class="toc-text">Block的循环引用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ARC下的循环引用"><span class="toc-number">5.4.1.</span> <span class="toc-text">ARC下的循环引用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#多线程"><span class="toc-number">6.</span> <span class="toc-text">多线程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GCD"><span class="toc-number">6.1.</span> <span class="toc-text">GCD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#同步-异步和串行-并发"><span class="toc-number">6.1.1.</span> <span class="toc-text">同步/异步和串行/并发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dispatch-barrier-async"><span class="toc-number">6.1.2.</span> <span class="toc-text">dispatch_barrier_async</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dispatch-group-async"><span class="toc-number">6.1.3.</span> <span class="toc-text">dispatch_group_async</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSOperation"><span class="toc-number">6.2.</span> <span class="toc-text">NSOperation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSThread"><span class="toc-number">6.3.</span> <span class="toc-text">NSThread</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#锁"><span class="toc-number">6.4.</span> <span class="toc-text">锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#synchronized"><span class="toc-number">6.4.1.</span> <span class="toc-text">@synchronized</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#automic"><span class="toc-number">6.4.2.</span> <span class="toc-text">automic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OSSpinLock"><span class="toc-number">6.4.3.</span> <span class="toc-text">OSSpinLock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSLock"><span class="toc-number">6.4.4.</span> <span class="toc-text">NSLock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NSRecursiveLock"><span class="toc-number">6.4.5.</span> <span class="toc-text">NSRecursiveLock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dispatch-semaphore-t"><span class="toc-number">6.4.6.</span> <span class="toc-text">dispatch_semaphore_t</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RunLoop"><span class="toc-number">7.</span> <span class="toc-text">RunLoop</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据结构-1"><span class="toc-number">7.1.</span> <span class="toc-text">数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CFRunLoop"><span class="toc-number">7.1.1.</span> <span class="toc-text">CFRunLoop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CFRunLoopMode"><span class="toc-number">7.1.2.</span> <span class="toc-text">CFRunLoopMode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CFRunLoopSource"><span class="toc-number">7.1.3.</span> <span class="toc-text">CFRunLoopSource</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CFRunLoopSource-1"><span class="toc-number">7.1.4.</span> <span class="toc-text">CFRunLoopSource</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CFRunLoopObserver"><span class="toc-number">7.1.5.</span> <span class="toc-text">CFRunLoopObserver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#各个数据结构之间的关系"><span class="toc-number">7.1.6.</span> <span class="toc-text">各个数据结构之间的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CommonMode的特性"><span class="toc-number">7.1.7.</span> <span class="toc-text">CommonMode的特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事件循环的实现机制"><span class="toc-number">7.1.8.</span> <span class="toc-text">事件循环的实现机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RunLoop的核心"><span class="toc-number">7.1.9.</span> <span class="toc-text">RunLoop的核心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RunLoop与NSTimer"><span class="toc-number">7.1.10.</span> <span class="toc-text">RunLoop与NSTimer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RunLoop与多线程"><span class="toc-number">7.1.11.</span> <span class="toc-text">RunLoop与多线程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#网络"><span class="toc-number">8.</span> <span class="toc-text">网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP"><span class="toc-number">8.1.</span> <span class="toc-text">HTTP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#请求报文"><span class="toc-number">8.1.1.</span> <span class="toc-text">请求报文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#响应报文"><span class="toc-number">8.1.2.</span> <span class="toc-text">响应报文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#请求方式"><span class="toc-number">8.1.3.</span> <span class="toc-text">请求方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GET和POST的区别"><span class="toc-number">8.1.4.</span> <span class="toc-text">GET和POST的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#状态码"><span class="toc-number">8.1.5.</span> <span class="toc-text">状态码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP连接"><span class="toc-number">8.1.6.</span> <span class="toc-text">HTTP连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP的特点"><span class="toc-number">8.1.7.</span> <span class="toc-text">HTTP的特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#持久连接"><span class="toc-number">8.1.8.</span> <span class="toc-text">持久连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP抓包"><span class="toc-number">8.1.9.</span> <span class="toc-text">HTTP抓包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTPS"><span class="toc-number">8.2.</span> <span class="toc-text">HTTPS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTPS与网络安全"><span class="toc-number">8.2.1.</span> <span class="toc-text">HTTPS与网络安全</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UDP（用户数据报协议）"><span class="toc-number">8.3.</span> <span class="toc-text">UDP（用户数据报协议）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特点："><span class="toc-number">8.3.1.</span> <span class="toc-text">特点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#功能"><span class="toc-number">8.3.2.</span> <span class="toc-text">功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP（传输控制协议）"><span class="toc-number">8.4.</span> <span class="toc-text">TCP（传输控制协议）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#面向连接"><span class="toc-number">8.4.1.</span> <span class="toc-text">面向连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#可靠传输"><span class="toc-number">8.4.2.</span> <span class="toc-text">可靠传输</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#面向字节流"><span class="toc-number">8.4.3.</span> <span class="toc-text">面向字节流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#流量控制"><span class="toc-number">8.4.4.</span> <span class="toc-text">流量控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#拥塞控制"><span class="toc-number">8.4.5.</span> <span class="toc-text">拥塞控制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS解析"><span class="toc-number">8.5.</span> <span class="toc-text">DNS解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#递归查询"><span class="toc-number">8.5.1.</span> <span class="toc-text">递归查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#迭代查询"><span class="toc-number">8.5.2.</span> <span class="toc-text">迭代查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS劫持"><span class="toc-number">8.5.3.</span> <span class="toc-text">DNS劫持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS解析转发"><span class="toc-number">8.5.4.</span> <span class="toc-text">DNS解析转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#httpDNS"><span class="toc-number">8.5.5.</span> <span class="toc-text">httpDNS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#长连接"><span class="toc-number">8.5.6.</span> <span class="toc-text">长连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cookie"><span class="toc-number">8.6.</span> <span class="toc-text">Cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#删除Cookie"><span class="toc-number">8.6.1.</span> <span class="toc-text">删除Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie安全"><span class="toc-number">8.6.2.</span> <span class="toc-text">Cookie安全</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Session"><span class="toc-number">8.7.</span> <span class="toc-text">Session</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#设计模式"><span class="toc-number">9.</span> <span class="toc-text">设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#六大设计原则"><span class="toc-number">9.1.</span> <span class="toc-text">六大设计原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#责任链"><span class="toc-number">9.2.</span> <span class="toc-text">责任链</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#桥接"><span class="toc-number">9.3.</span> <span class="toc-text">桥接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#适配器"><span class="toc-number">9.4.</span> <span class="toc-text">适配器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#单例"><span class="toc-number">9.5.</span> <span class="toc-text">单例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#命令"><span class="toc-number">9.6.</span> <span class="toc-text">命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#架构-框架"><span class="toc-number">10.</span> <span class="toc-text">架构/框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#图片缓存"><span class="toc-number">10.1.</span> <span class="toc-text">图片缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#内存设计"><span class="toc-number">10.1.1.</span> <span class="toc-text">内存设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#磁盘设计"><span class="toc-number">10.1.2.</span> <span class="toc-text">磁盘设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#网络设计"><span class="toc-number">10.1.3.</span> <span class="toc-text">网络设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图片解码"><span class="toc-number">10.1.4.</span> <span class="toc-text">图片解码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#线程处理"><span class="toc-number">10.1.5.</span> <span class="toc-text">线程处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#阅读时长统计"><span class="toc-number">10.2.</span> <span class="toc-text">阅读时长统计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#记录器"><span class="toc-number">10.2.1.</span> <span class="toc-text">记录器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#记录的缓存-amp-存储"><span class="toc-number">10.2.2.</span> <span class="toc-text">记录的缓存 &amp; 存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#记录上传器"><span class="toc-number">10.2.3.</span> <span class="toc-text">记录上传器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#复杂页面框架"><span class="toc-number">10.3.</span> <span class="toc-text">复杂页面框架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MVVM"><span class="toc-number">10.3.1.</span> <span class="toc-text">MVVM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RN数据流思想"><span class="toc-number">10.3.2.</span> <span class="toc-text">RN数据流思想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#客户端整体架构"><span class="toc-number">10.3.3.</span> <span class="toc-text">客户端整体架构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#算法"><span class="toc-number">11.</span> <span class="toc-text">算法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#字符串反转"><span class="toc-number">11.1.</span> <span class="toc-text">字符串反转</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#单链表反转"><span class="toc-number">11.2.</span> <span class="toc-text">单链表反转</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#有序数组归并"><span class="toc-number">11.3.</span> <span class="toc-text">有序数组归并</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#哈希表"><span class="toc-number">11.4.</span> <span class="toc-text">哈希表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#共同父视图"><span class="toc-number">11.5.</span> <span class="toc-text">共同父视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#无效数组职工查找中位数"><span class="toc-number">11.6.</span> <span class="toc-text">无效数组职工查找中位数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#排序算法"><span class="toc-number">11.6.1.</span> <span class="toc-text">排序算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#中位数"><span class="toc-number">11.6.2.</span> <span class="toc-text">中位数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#快排思想"><span class="toc-number">11.6.3.</span> <span class="toc-text">快排思想</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第三方"><span class="toc-number">12.</span> <span class="toc-text">第三方</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AFNetworking"><span class="toc-number">12.1.</span> <span class="toc-text">AFNetworking</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#框架图"><span class="toc-number">12.1.1.</span> <span class="toc-text">框架图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类关系图"><span class="toc-number">12.1.2.</span> <span class="toc-text">类关系图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AFURLSessionManager"><span class="toc-number">12.1.3.</span> <span class="toc-text">AFURLSessionManager</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SDWebImage"><span class="toc-number">12.2.</span> <span class="toc-text">SDWebImage</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#框架图-1"><span class="toc-number">12.2.1.</span> <span class="toc-text">框架图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加载图片流程"><span class="toc-number">12.2.2.</span> <span class="toc-text">加载图片流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ReactiveCocoa"><span class="toc-number">12.3.</span> <span class="toc-text">ReactiveCocoa</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#类关系图-1"><span class="toc-number">12.3.1.</span> <span class="toc-text">类关系图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#信号"><span class="toc-number">12.3.2.</span> <span class="toc-text">信号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#订阅"><span class="toc-number">12.3.3.</span> <span class="toc-text">订阅</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AsyncDisplayKit"><span class="toc-number">12.4.</span> <span class="toc-text">AsyncDisplayKit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基本原理"><span class="toc-number">12.4.1.</span> <span class="toc-text">基本原理</span></a></li></ol></li></ol></li></ol>
   </div>
   <script type="text/javascript">
    function showToc(){
        var toc_article = document.getElementById("toc-article");
        var show_toc_btn = document.getElementById("show-toc-btn");
        toc_article.setAttribute("style","display:block");
        show_toc_btn.setAttribute("style","display:none");
        };
    function showBtn(){
        var toc_article = document.getElementById("toc-article");
        var show_toc_btn = document.getElementById("show-toc-btn");
        toc_article.setAttribute("style","display:none");
        show_toc_btn.setAttribute("style","display:block");
        };
   </script>
 
<!-- 目录内容结束 -->
<!-- 文章 -->
<article class="post article" onclick="showBtn();">
    <header class="text-center">
        <h3 class="post-title"><span>iOS知识小集</span></h3>
    </header>
    <p class="post-meta text-center">
        曾华经
		&emsp;发表于：<time datetime="2019-07-18T01:48:49.000Z">2019-07-18</time>
		&emsp;修改于：<time datetime="2019-08-22T09:17:53.621Z">2019-08-22</time>
		&emsp;总阅读量：<span id="busuanzi_value_page_pv"><i class="fa fa-spinner"></i></span>次
    </p>
    <div class="post-content">
        <p>&emsp;&emsp;在此汇总整理了一些iOS学习方面的东西，跟大家一起分享下。</p>
<a id="more"></a>
<h1 id="UI视图"><a href="#UI视图" class="headerlink" title="UI视图"></a>UI视图</h1><h2 id="事件传递机制"><a href="#事件传递机制" class="headerlink" title="事件传递机制"></a>事件传递机制</h2><h3 id="UIView和CALayer"><a href="#UIView和CALayer" class="headerlink" title="UIView和CALayer"></a>UIView和CALayer</h3><p>1、UIView负责响应事件，CALayer负责绘制UI</p>
<ul>
<li><code>UIView</code>继承自<code>UIResponder</code>，而<code>UIResponder</code>是响应者对象，实现了如下API，所以继承自<code>UIResponder</code>的都具有响应事件的能力</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesMoved:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesEnded:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesCancelled:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesEstimatedPropertiesUpdated:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>CALayer</code>继承自<code>NSObject</code>，所以<code>CALayer</code>不具备响应处理事件的能力。<code>CALayer</code>是<code>QuartzCore</code>中的类，是一个比较底层的用来绘制内容的类。</li>
</ul>
<p>2、UIView持有一个CALayer的属性，UIView是CALayer的代理，二者协同工作</p>
<ul>
<li>UIView设置frame、center、bounds等位置信息，其实都是UIView对CALayer的封装，使得我们可以很方便地设置控件的位置。但是圆角、阴影等属性，UIView就没有进一步封装，所以我们还是需要去设置Layer的属性来实现功能。</li>
<li>UIView持有一个CALayer的属性，并且是该属性的代理，用来提供一些CALayer需要的数据，例如动画和绘制。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//绘制相关</span></span><br><span class="line">- (<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)layer inContext:(<span class="built_in">CGContextRef</span>)ctx;</span><br><span class="line"><span class="comment">//动画相关</span></span><br><span class="line">- (<span class="keyword">id</span>&lt;<span class="built_in">CAAction</span>&gt;)actionForLayer:(<span class="built_in">CALayer</span> *)layer forKey:(<span class="built_in">NSString</span> *)event;</span><br></pre></td></tr></table></figure>
<h3 id="事件传递"><a href="#事件传递" class="headerlink" title="事件传递"></a>事件传递</h3><p>UIView提供了以下两个方法，来进行iOS中事件的响应及传递（响应者链）</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIView</span> *)hitTest:(<span class="built_in">CGPoint</span>)point withEvent:(<span class="built_in">UIEvent</span> *)event;</span><br><span class="line">- (<span class="built_in">BOOL</span>)pointInside:(<span class="built_in">CGPoint</span>)point withEvent:(<span class="built_in">UIEvent</span> *)event;</span><br></pre></td></tr></table></figure>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/iOS%E4%BA%8B%E4%BB%B6%E5%93%8D%E5%BA%94.png" alt="iOS事件响应"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/iOS%E4%BA%8B%E4%BB%B6%E5%93%8D%E5%BA%942.png" alt="iOS事件响应2"></p>
<h2 id="UI绘制原理"><a href="#UI绘制原理" class="headerlink" title="UI绘制原理"></a>UI绘制原理</h2><h3 id="图像显示原理"><a href="#图像显示原理" class="headerlink" title="图像显示原理"></a>图像显示原理</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E5%83%8F%E6%98%BE%E7%A4%BA%E5%8E%9F%E7%90%86.png" alt="图像显示原理"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E5%83%8F%E6%98%BE%E7%A4%BA%E5%8E%9F%E7%90%862.png" alt="图像显示原理2"></p>
<h3 id="CPU工作"><a href="#CPU工作" class="headerlink" title="CPU工作"></a>CPU工作</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/CPU%E5%B7%A5%E4%BD%9C.png" alt="CPU工作"></p>
<h3 id="GPU渲染管线"><a href="#GPU渲染管线" class="headerlink" title="GPU渲染管线"></a>GPU渲染管线</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/GPU%E6%B8%B2%E6%9F%93%E7%AE%A1%E7%BA%BF.png" alt="GPU渲染管线"></p>
<h3 id="UI卡顿、掉帧的原因"><a href="#UI卡顿、掉帧的原因" class="headerlink" title="UI卡顿、掉帧的原因"></a>UI卡顿、掉帧的原因</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/UI%E5%8D%A1%E9%A1%BF%E6%8E%89%E5%B8%A7.png" alt="UI卡顿掉帧的原因"></p>
<h3 id="滑动优化方案"><a href="#滑动优化方案" class="headerlink" title="滑动优化方案"></a>滑动优化方案</h3><ul>
<li>CPU<ul>
<li>对象创建、<strong>调整</strong>、<strong>销毁</strong></li>
<li>预排版（布局计算，文本计算）</li>
<li><strong>预渲染（文本异步绘制，图片编解码等）</strong></li>
</ul>
</li>
<li>GPU<ul>
<li><strong>纹理渲染</strong></li>
<li><strong>视图混合</strong></li>
</ul>
</li>
</ul>
<h3 id="UIView绘制原理"><a href="#UIView绘制原理" class="headerlink" title="UIView绘制原理"></a>UIView绘制原理</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/UIView%E7%BB%98%E5%88%B6%E5%8E%9F%E7%90%86.png" alt="UIView绘制原理"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/UIView%E7%BB%98%E5%88%B6%E5%8E%9F%E7%90%862.png" alt="UIView绘制原理2"></p>
<h2 id="异步绘制原理"><a href="#异步绘制原理" class="headerlink" title="异步绘制原理"></a>异步绘制原理</h2><ul>
<li>[layer.delegate displayLayer:]<ul>
<li>代理负责生成对应的bitmap</li>
<li>设置该bitmap作为layer.contents属性的值</li>
</ul>
</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%BC%82%E6%AD%A5%E7%BB%98%E5%88%B6.png" alt="异步绘制"></p>
<h2 id="离屏渲染"><a href="#离屏渲染" class="headerlink" title="离屏渲染"></a>离屏渲染</h2><ul>
<li><p>On-Screen Rendering：意为当前屏幕渲染，指的是GPU的渲染操作是在当前用于显示的屏幕缓冲区中进行</p>
</li>
<li><p>Off-Screen Rendering：意为离屏渲染，指的是GPU在当前屏幕缓冲区以外新开辟一个缓冲区进行渲染操作</p>
<ul>
<li>圆角（当和maskToBounds一起使用时）</li>
<li>图层蒙版</li>
<li>阴影</li>
<li>光栅化</li>
</ul>
</li>
</ul>
<p>为何要避免？</p>
<ul>
<li>创建新的渲染缓存区</li>
<li>上下文切换</li>
</ul>
<h1 id="OC语言"><a href="#OC语言" class="headerlink" title="OC语言"></a>OC语言</h1><h2 id="分类（Category）"><a href="#分类（Category）" class="headerlink" title="分类（Category）"></a>分类（Category）</h2><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>运行时决议</li>
<li>可以为系统类添加分类</li>
</ul>
<h3 id="可以添加的内容"><a href="#可以添加的内容" class="headerlink" title="可以添加的内容"></a>可以添加的内容</h3><ul>
<li>实例方法</li>
<li>类方法</li>
<li>协议</li>
<li>属性</li>
</ul>
<h3 id="加载调用栈"><a href="#加载调用栈" class="headerlink" title="加载调用栈"></a>加载调用栈</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%88%86%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%B0%83%E7%94%A8%E6%A0%88.png" alt="分类加载调用栈"></p>
<ul>
<li>分类添加的方法可以“覆盖”原类方法</li>
<li>同名分类方法谁生效取决于编译顺序</li>
<li>名字相同的分类会引起编译报错</li>
</ul>
<h2 id="关联对象"><a href="#关联对象" class="headerlink" title="关联对象"></a>关联对象</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">objc_getAssociatedObject(<span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key);</span><br><span class="line"></span><br><span class="line">objc_setAssociatedObject(<span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key,</span><br><span class="line">                         <span class="keyword">id</span> value, objc_AssociationPolicy policy);</span><br><span class="line"></span><br><span class="line">objc_removeAssociatedObjects(<span class="keyword">id</span> object);</span><br></pre></td></tr></table></figure>
<h3 id="关联对象的本质"><a href="#关联对象的本质" class="headerlink" title="关联对象的本质"></a>关联对象的本质</h3><p>关联对象由<code>AssociationManager</code>管理并在<code>AssociationHashMap</code>存储。所有对象的关联内容都在<strong>同一个全局容器</strong>中。</p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8.png" alt="关联对象的本质"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"0x4927298742"</span>:&#123;</span><br><span class="line">		<span class="attr">"@selector(text)"</span>:&#123;</span><br><span class="line">			<span class="attr">"value"</span>:<span class="string">"Hello"</span>,</span><br><span class="line">			<span class="attr">"policy"</span>:<span class="string">"retain"</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"@selector(title)"</span>:&#123;</span><br><span class="line">			<span class="attr">"value"</span>:<span class="string">"a object"</span>,</span><br><span class="line">			<span class="attr">"policy"</span>:<span class="string">"copy"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"0x3428163871"</span>:&#123;</span><br><span class="line">		<span class="attr">"@selector(backgroundColor)"</span>:&#123;</span><br><span class="line">			<span class="attr">"value"</span>:<span class="string">"0xff8205"</span>,</span><br><span class="line">			<span class="attr">"policy"</span>:<span class="string">"retain"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><ul>
<li>编译时决议</li>
<li>只以声明的形式存在，多数情况下寄生于宿主类的.m中</li>
<li>不能为系统类添加扩展</li>
</ul>
<h2 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h2><ul>
<li>准确的说是一种软件设计模式</li>
<li>iOS当中以<strong>@protocol</strong>形式提现</li>
<li>传递方式为<strong>一对一</strong></li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E4%BB%A3%E7%90%86.png" alt="代理"></p>
<ul>
<li>一般声明为<strong>weak</strong>以规避循环引用</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E4%BB%A3%E7%90%862.png" alt="代理2"></p>
<h2 id="通知"><a href="#通知" class="headerlink" title="通知"></a>通知</h2><ul>
<li>使用<strong>观察者模式</strong>来实现的用于跨层传递消息的机制</li>
<li>传递方式为<strong>一对对</strong></li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E9%80%9A%E7%9F%A5.png" alt="通知"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E9%80%9A%E7%9F%A5%E6%9C%BA%E5%88%B6.png" alt="通知机制"></p>
<h2 id="KVO"><a href="#KVO" class="headerlink" title="KVO"></a>KVO</h2><ul>
<li>KVO是Key-value observing的缩写</li>
<li>KVO是Objective-C对<strong>观察者模式</strong>的又一实现</li>
<li>Apple 使用了isa混写（<strong>isa-swizzling</strong>）来实现KVO</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/KVO.png" alt="KVO"></p>
<h3 id="触发条件"><a href="#触发条件" class="headerlink" title="触发条件"></a>触发条件</h3><ul>
<li>使用setter方法改变值KVO才会生效</li>
<li>使用<code>setValue:forKey:</code>改变值KVO才会生效</li>
<li>成员变量直接修改需<strong>手动添加</strong>KVO才会生效</li>
</ul>
<h2 id="KVC"><a href="#KVC" class="headerlink" title="KVC"></a>KVC</h2><p>KVC是Key-value coding的缩写</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)valueForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setValue:(<span class="keyword">id</span>)value forKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/KVC.png" alt="KVC"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/KVC2.png" alt="KVC2"></p>
<h3 id="Accessor-Method"><a href="#Accessor-Method" class="headerlink" title="Accessor Method"></a>Accessor Method</h3><ul>
<li>&#60;getKey&#62;</li>
<li>&#60;key&#62;</li>
<li>&#60;isKey&#62;</li>
</ul>
<h3 id="Instance-var"><a href="#Instance-var" class="headerlink" title="Instance var"></a>Instance var</h3><ul>
<li>_key</li>
<li>_isKey</li>
<li>key</li>
<li>isKey</li>
</ul>
<h2 id="属性关键字"><a href="#属性关键字" class="headerlink" title="属性关键字"></a>属性关键字</h2><ul>
<li>读写权限<ul>
<li>readonly</li>
<li><strong>rewrite</strong></li>
</ul>
</li>
<li>原子性<ul>
<li><strong>atomic</strong></li>
<li>nonatomic</li>
</ul>
</li>
<li>引用计数<ul>
<li>retain/<strong>strong</strong></li>
<li><strong>assign</strong>/unsafe_unretained</li>
<li>weak</li>
<li>copy</li>
</ul>
</li>
</ul>
<h3 id="assign"><a href="#assign" class="headerlink" title="assign"></a>assign</h3><ul>
<li>修饰基本数据类型，如int、BOOL等</li>
<li>修饰对象类型时，不改变其引用计数</li>
<li>会产生悬垂指针</li>
</ul>
<h3 id="weak"><a href="#weak" class="headerlink" title="weak"></a>weak</h3><ul>
<li>不改变被修饰对象的引用计数</li>
<li>所指对象在被释放之后会自动置为nil</li>
</ul>
<h3 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h3><ul>
<li>浅拷贝：对内存地址的复制，让目标对象指针和源对象指向<strong>同一片</strong>内存空间</li>
<li>深拷贝：深拷贝让目标对象指针和源对象指针指向<strong>两片</strong>内容相同的内存空间</li>
</ul>
<p>深拷贝VS浅拷贝</p>
<ul>
<li>是否开辟了新的内存空间</li>
<li>是否影响了引用计数</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/copy%E5%85%B3%E9%94%AE%E5%AD%97.png" alt="copy关键字"></p>
<h1 id="Runtime"><a href="#Runtime" class="headerlink" title="Runtime"></a>Runtime</h1><h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><h3 id="objc-object"><a href="#objc-object" class="headerlink" title="objc_object"></a>objc_object</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/objc_object.png" alt="objc_object"></p>
<h3 id="objc-class"><a href="#objc-class" class="headerlink" title="objc_class"></a>objc_class</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/objc_class.png" alt="objc_class"></p>
<h3 id="isa指针"><a href="#isa指针" class="headerlink" title="isa指针"></a>isa指针</h3><p>共用体<code>isa_t</code></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/isa.png" alt="isa"></p>
<p><code>isa</code>指向</p>
<ul>
<li>关于<strong>对象</strong>，其指向<strong>类对象</strong></li>
<li>关于<strong>类对象</strong>，其指向<strong>元类对象</strong></li>
</ul>
<h3 id="cache-t"><a href="#cache-t" class="headerlink" title="cache_t"></a>cache_t</h3><ul>
<li>用于<strong>快速</strong>查找方法执行函数</li>
<li>是可<strong>增量扩展</strong>的<strong>哈希表</strong>结构</li>
<li>是<strong>局部性原理</strong>的最佳应用</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/cache_t.png" alt="cache_t"></p>
<h3 id="class-data-bits-t"><a href="#class-data-bits-t" class="headerlink" title="class_data_bits_t"></a>class_data_bits_t</h3><ul>
<li><code>class_data_bits_t</code>主要是对<code>class_rw_t</code>的封装</li>
<li><code>class_rw_t</code>代表了类相关的<strong>读写</strong>信息、对<code>class_ro_t</code>的封装</li>
<li><code>class_ro_t</code>代表了类相关的<strong>只读</strong>信息</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/class_rw_t.png" alt="class_rw_t"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/class_ro_t.png" alt="class_ro_t"></p>
<h3 id="method-t"><a href="#method-t" class="headerlink" title="method_t"></a>method_t</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/method_t.png" alt="method_t"></p>
<p>Type Encodings</p>
<ul>
<li>const char *types</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/Type%20Encodings.png" alt="Type Encodings"></p>
<h3 id="Objective-C对象数据结构"><a href="#Objective-C对象数据结构" class="headerlink" title="Objective-C对象数据结构"></a>Objective-C对象数据结构</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/OC%E5%AF%B9%E8%B1%A1%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.png" alt="OC对象数据结构"></p>
<h2 id="对象、类对象、元类对象"><a href="#对象、类对象、元类对象" class="headerlink" title="对象、类对象、元类对象"></a>对象、类对象、元类对象</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%AF%B9%E8%B1%A1%E5%85%83%E7%B1%BB%E5%AF%B9%E8%B1%A1.png" alt="对象类对象元类对象"></p>
<h2 id="消息传递机制"><a href="#消息传递机制" class="headerlink" title="消息传递机制"></a>消息传递机制</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92.png" alt="消息传递"></p>
<h3 id="缓存查找"><a href="#缓存查找" class="headerlink" title="缓存查找"></a>缓存查找</h3><p>给定值是<code>SEL</code>，目标值是对应<code>bucket_t</code>中的<code>IMP</code>。</p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E7%BC%93%E5%AD%98%E6%9F%A5%E6%89%BE.png" alt="缓存查找"></p>
<h3 id="当前类中查找"><a href="#当前类中查找" class="headerlink" title="当前类中查找"></a>当前类中查找</h3><ul>
<li>对于<strong>已排序好</strong>的列表，采用二分查找算法查找方法对应执行函数。</li>
<li>对于<strong>没有排序</strong>的列表，采用一般遍历查找方法对应执行函数。</li>
</ul>
<h3 id="父类逐级查找"><a href="#父类逐级查找" class="headerlink" title="父类逐级查找"></a>父类逐级查找</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E7%88%B6%E7%B1%BB%E9%80%90%E7%BA%A7%E6%9F%A5%E6%89%BE.png" alt="父类逐级查找"></p>
<h2 id="消息转发机制"><a href="#消息转发机制" class="headerlink" title="消息转发机制"></a>消息转发机制</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91%E6%B5%81%E7%A8%8B.png" alt="消息转发流程"></p>
<h2 id="Method-Swizzling"><a href="#Method-Swizzling" class="headerlink" title="Method-Swizzling"></a>Method-Swizzling</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/MethodSwizzling.png" alt="MethodSwizzling"></p>
<h2 id="动态方法解析"><a href="#动态方法解析" class="headerlink" title="动态方法解析"></a>动态方法解析</h2><p>@dynamic</p>
<ul>
<li>动态运行时语言将函数决议推迟到运行时。</li>
<li>编译时语言在编译期进行函数决议。</li>
</ul>
<h1 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h1><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.png" alt="内存分配"></p>
<h2 id="内存管理方案"><a href="#内存管理方案" class="headerlink" title="内存管理方案"></a>内存管理方案</h2><ul>
<li>TaggedPointer：有些对象如果支持使用TaggedPointer（对象指针最后一位为1），苹果会直接将其指针值作为引用计数返回</li>
<li>NONPOINTER_ISA：如果当前设备是64位环境并且使用Objective-C 2.0，那么“一些”对象会使用其isa指针的一部分空间来存储它的引用计数（isa指针最后一位为1）</li>
<li>散列表：包含自旋锁、引用计数表、弱引用表等</li>
</ul>
<h3 id="arm64架构"><a href="#arm64架构" class="headerlink" title="arm64架构"></a>arm64架构</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/arm64%E6%9E%B6%E6%9E%84.png" alt="arm64架构"></p>
<h3 id="散列表方式"><a href="#散列表方式" class="headerlink" title="散列表方式"></a>散列表方式</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/SideTables.png" alt="SideTables"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/SideTable.png" alt="SideTable"></p>
<h3 id="Hash查找"><a href="#Hash查找" class="headerlink" title="Hash查找"></a>Hash查找</h3><p>给定值是对象内存地址，目标值是数组下标索引。</p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/Hash%E6%9F%A5%E6%89%BE.png" alt="Hash查找"></p>
<h2 id="自旋锁"><a href="#自旋锁" class="headerlink" title="自旋锁"></a>自旋锁</h2><ul>
<li><code>Spinlock_t</code>是“忙等”的锁。</li>
<li>适用于轻量访问。</li>
</ul>
<h2 id="引用技术表"><a href="#引用技术表" class="headerlink" title="引用技术表"></a>引用技术表</h2><h3 id="RefcountMap"><a href="#RefcountMap" class="headerlink" title="RefcountMap"></a>RefcountMap</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/RefcountMap.png" alt="RefcountMap"></p>
<h3 id="size-t"><a href="#size-t" class="headerlink" title="size_t"></a>size_t</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/size_t.png" alt="size_t"></p>
<h2 id="弱引用表"><a href="#弱引用表" class="headerlink" title="弱引用表"></a>弱引用表</h2><h3 id="weak-table-t"><a href="#weak-table-t" class="headerlink" title="weak_table_t"></a>weak_table_t</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/weak_table_t.png" alt="weak_table_t"></p>
<h2 id="ARC、MRC"><a href="#ARC、MRC" class="headerlink" title="ARC、MRC"></a>ARC、MRC</h2><h3 id="MRC"><a href="#MRC" class="headerlink" title="MRC"></a>MRC</h3><p>手动引用计数</p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/MRC.png" alt="MRC"></p>
<h3 id="ARC"><a href="#ARC" class="headerlink" title="ARC"></a>ARC</h3><p>自动引用计数</p>
<ul>
<li>ARC是<strong>LLVM</strong>和<strong>Runtime</strong>协作的结果</li>
<li>ARC中禁止手动调用<code>retain</code>/<code>release</code>/<code>retainCount</code>/<code>dealloc</code></li>
<li>ARC中新增<code>weak</code>、<code>strong</code>属性关键字</li>
</ul>
<h2 id="引用计数管理"><a href="#引用计数管理" class="headerlink" title="引用计数管理"></a>引用计数管理</h2><h3 id="alloc实现"><a href="#alloc实现" class="headerlink" title="alloc实现"></a>alloc实现</h3><ul>
<li>经过一系列调用，最终调用了C函数calloc。</li>
<li>此时并没有设置引用计数为1。</li>
</ul>
<h3 id="retain实现"><a href="#retain实现" class="headerlink" title="retain实现"></a>retain实现</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SideTable&amp; table = SideTables()[<span class="keyword">this</span>];</span><br><span class="line"></span><br><span class="line">size_t&amp; refcntStorage = table.refcnts[<span class="keyword">this</span>];</span><br><span class="line"></span><br><span class="line">refcntStorage += SIDE_TABLE_RC_ONE;</span><br></pre></td></tr></table></figure>
<h3 id="release实现"><a href="#release实现" class="headerlink" title="release实现"></a>release实现</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SideTable&amp; table = SideTables()[<span class="keyword">this</span>];</span><br><span class="line"></span><br><span class="line">RefcountMap::iterator it = table.refcnts.find(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">it-&gt;second -= SIDE_TABLE_RC_ONE;</span><br></pre></td></tr></table></figure>
<h3 id="retainCount实现"><a href="#retainCount实现" class="headerlink" title="retainCount实现"></a>retainCount实现</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SideTable&amp; table = SideTables()[<span class="keyword">this</span>];</span><br><span class="line"></span><br><span class="line">size_t refcnt_result = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">RefcountMap::iterator it = table.refcnts.find(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">refcnt_result += it-&gt;second &gt;&gt; SIDE_TABLE_RC_SHIFT;</span><br></pre></td></tr></table></figure>
<h3 id="dealloc实现"><a href="#dealloc实现" class="headerlink" title="dealloc实现"></a>dealloc实现</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/dealloc.png" alt="dealloc"></p>
<ul>
<li>object_dispose()</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/object_dispose.png" alt="object_dispose"></p>
<ul>
<li>objc_destructInstance()</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/objc_destructInstance.png" alt="objc_destructInstance"></p>
<ul>
<li>clearDeallocating()</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/clearDeallocating.png" alt="clearDeallocating"></p>
<h2 id="弱引用管理"><a href="#弱引用管理" class="headerlink" title="弱引用管理"></a>弱引用管理</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%BC%B1%E5%BC%95%E7%94%A8%E7%AE%A1%E7%90%86.png" alt="弱引用管理"></p>
<ul>
<li>添加weak变量</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E6%B7%BB%E5%8A%A0weak%E5%8F%98%E9%87%8F.png" alt="添加weak变量"></p>
<ul>
<li>清除weak变量，同时设置指向为nil</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E6%B8%85%E9%99%A4weak%E5%8F%98%E9%87%8F.png" alt="清除weak变量"></p>
<h2 id="自动释放池"><a href="#自动释放池" class="headerlink" title="自动释放池"></a>自动释放池</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E8%87%AA%E5%8A%A8%E9%87%8A%E6%94%BE%E6%B1%A0.png" alt="自动释放池"></p>
<ul>
<li>是以<strong>栈</strong>为结点通过<strong>双向链表</strong>的形式组合而成</li>
<li>是和<strong>线程</strong>一一对应的</li>
</ul>
<h3 id="AutoreleasePoolPage"><a href="#AutoreleasePoolPage" class="headerlink" title="AutoreleasePoolPage"></a>AutoreleasePoolPage</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/AutoreleasePoolPage.png" alt="AutoreleasePoolPage"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/AutoreleasePoolPage2.png" alt="AutoreleasePoolPage"></p>
<h3 id="AutoreleasePoolPage-push"><a href="#AutoreleasePoolPage-push" class="headerlink" title="AutoreleasePoolPage::push"></a>AutoreleasePoolPage::push</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/AutoreleasePoolPagePush.png" alt="AutoreleasePoolPagePush"></p>
<h3 id="autorelease"><a href="#autorelease" class="headerlink" title="autorelease"></a>autorelease</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/autorelease.png" alt="autorelease"></p>
<h3 id="AutoreleasePoolPage-pop"><a href="#AutoreleasePoolPage-pop" class="headerlink" title="AutoreleasePoolPage::pop"></a>AutoreleasePoolPage::pop</h3><ul>
<li>根据传入的哨兵对象找到对应位置</li>
<li>给上次push操作之后添加的对象依次发送release消息</li>
<li>回退next指针到正确位置</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/AutoreleasePoolPagePop.png" alt="AutoreleasePoolPagePop"></p>
<h3 id="autoreleasepool总结"><a href="#autoreleasepool总结" class="headerlink" title="@autoreleasepool总结"></a>@autoreleasepool总结</h3><ul>
<li>在当前RunLoop将要结束的时候调用AutoreleasePoolPage::pop()</li>
<li>多层嵌套就是多次插入哨兵对象</li>
<li>在for循环中alloc图片数据等内存消耗较大的场景手动插入autoreleasePool</li>
</ul>
<h2 id="循环引用"><a href="#循环引用" class="headerlink" title="循环引用"></a>循环引用</h2><h3 id="种类"><a href="#种类" class="headerlink" title="种类"></a>种类</h3><ul>
<li>自循环引用</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E8%87%AA%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8.png" alt="自循环引用"></p>
<ul>
<li>相互循环引用</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E7%9B%B8%E4%BA%92%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8.png" alt="相互循环引用"></p>
<ul>
<li>多循环引用</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%A4%9A%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8.png" alt="多循环引用"></p>
<h3 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h3><ul>
<li>代理</li>
<li>Block</li>
<li>NSTimer</li>
<li>大环引用</li>
</ul>
<h3 id="破解"><a href="#破解" class="headerlink" title="破解"></a>破解</h3><ul>
<li><strong>避免产生循环引用</strong></li>
<li><strong>在合适的时机手动断环</strong></li>
</ul>
<p>具体解决方案：</p>
<ul>
<li><strong>__weak</strong></li>
<li><strong>__block</strong><ul>
<li><strong>MRC</strong>下，__block修饰对象不会增加其引用计数，<strong>避免</strong>了循环引用</li>
<li><strong>ARC</strong>下，__block修饰对象会被强引用，<strong>无法避免</strong>循环引用，<strong>需手动解环</strong></li>
</ul>
</li>
<li><strong>__unsafe_unretained</strong><ul>
<li>修饰对象不会增加其引用计数，<strong>避免</strong>了循环引用</li>
<li>如果被修饰对象在某一时机被释放，会产生<strong>悬垂指针</strong></li>
</ul>
</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/NSTimer%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8.png" alt="NSTimer循环引用"></p>
<h1 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h1><blockquote>
<p>Block是将<strong>函数</strong>及其<strong>执行上下文</strong>封装起来的<strong>对象</strong>。Block调用即是<strong>函数的调用</strong></p>
</blockquote>
<h2 id="截获变量"><a href="#截获变量" class="headerlink" title="截获变量"></a>截获变量</h2><ul>
<li>局部变量<ul>
<li>基本数据类型：截获其<strong>值</strong></li>
<li>对象类型：<strong>连同所有权修饰符</strong>一起截获</li>
</ul>
</li>
<li>静态局部变量：以<strong>指针形式</strong>截获</li>
<li>全局变量：<strong>不截获</strong></li>
<li>静态全局变量：<strong>不截获</strong></li>
</ul>
<h2 id="block修饰符"><a href="#block修饰符" class="headerlink" title="__block修饰符"></a>__block修饰符</h2><ul>
<li><strong>一般情况下</strong>，对被截获变量进行<strong>赋值</strong>操作需要添加__block修饰符</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/__block%E4%BF%AE%E9%A5%B0%E7%AC%A6.png" alt="__block修饰符"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/__block%E4%BF%AE%E9%A5%B0%E7%AC%A62.png" alt="__block修饰符2"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/__block%E4%BF%AE%E9%A5%B0%E7%AC%A63.png" alt="__block修饰符3"></p>
<ul>
<li>__block修饰的变量变成了对象</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/__block%E4%BF%AE%E9%A5%B0%E7%AC%A64.png" alt="__block修饰符4"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/__block%E4%BF%AE%E9%A5%B0%E7%AC%A65.png" alt="__block修饰符5"></p>
<h2 id="Block的内存管理"><a href="#Block的内存管理" class="headerlink" title="Block的内存管理"></a>Block的内存管理</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/Block%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86.png" alt="Block内存管理"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/Block%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%862.png" alt="Block内存管理2"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/Block%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%863.png" alt="Block内存管理3"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/Block%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%864.png" alt="Block内存管理4"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/Block%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%865.png" alt="Block内存管理5"></p>
<h2 id="Block的循环引用"><a href="#Block的循环引用" class="headerlink" title="Block的循环引用"></a>Block的循环引用</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/Block%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8.png" alt="Block循环引用"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/Block%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A82.png" alt="Block循环引用2"></p>
<h3 id="ARC下的循环引用"><a href="#ARC下的循环引用" class="headerlink" title="ARC下的循环引用"></a>ARC下的循环引用</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/Block%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A83.png" alt="Block循环引用3"></p>
<h1 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h1><h2 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h2><h3 id="同步-异步和串行-并发"><a href="#同步-异步和串行-并发" class="headerlink" title="同步/异步和串行/并发"></a>同步/异步和串行/并发</h3><ul>
<li>同步串行：<strong>dispatch_sync</strong>(serial_queue, \^{ // 任务})</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%90%8C%E6%AD%A5%E4%B8%B2%E8%A1%8C.png" alt="同步串行"></p>
<p><strong>死锁原因</strong></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E6%AD%BB%E9%94%81%E5%8E%9F%E5%9B%A0.png" alt="死锁原因"></p>
<ul>
<li>异步串行：dispatch_async(serial_queue, \^{ // 任务})</li>
<li>同步并发：<strong>dispatch_sync</strong>(concurrent_queue, \^{ // 任务})</li>
<li>异步并发：dispatch_async(concurrent_queue, \^{ // 任务})</li>
</ul>
<h3 id="dispatch-barrier-async"><a href="#dispatch-barrier-async" class="headerlink" title="dispatch_barrier_async"></a>dispatch_barrier_async</h3><p>使用场景：多读单写</p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%A4%9A%E8%AF%BB%E5%8D%95%E5%86%99.png" alt="多读单写"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%A4%9A%E8%AF%BB%E5%8D%95%E5%86%992.png" alt="多读单写2"></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)objectForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">	__block <span class="keyword">id</span> obj;</span><br><span class="line">	<span class="comment">// 同步读取指定数据</span></span><br><span class="line">	<span class="built_in">dispatch_sync</span>(concurrent_queue, ^&#123;</span><br><span class="line">		obj = [userCenterDic objectForKey:key];</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> obj;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">id</span>)obj forKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">	<span class="comment">// 异步栅栏调用设置数据</span></span><br><span class="line">	dispatch_barrier_async(concurrent_queue, ^&#123;</span><br><span class="line">		[userCenterDic setObject:obj forKey:key];</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="dispatch-group-async"><a href="#dispatch-group-async" class="headerlink" title="dispatch_group_async"></a>dispatch_group_async</h3><p>使用场景：A、B、C三个任务并发，完成后执行任务D</p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/dispatch_group_async.png" alt="dispatch_group_async"></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个group</span></span><br><span class="line">dispatch_group_t group = dispatch_group_create();</span><br><span class="line">    </span><br><span class="line"><span class="comment">// for循环遍历各个元素执行操作</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">NSURL</span> *url <span class="keyword">in</span> arrayURLs) &#123;</span><br><span class="line">	<span class="comment">// 异步组分派到并发队列当中</span></span><br><span class="line">	dispatch_group_async(group, concurrent_queue, ^&#123;</span><br><span class="line">		<span class="comment">// 根据url去下载图片</span></span><br><span class="line">            </span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">	<span class="comment">// 当添加到组中的所有任务执行完成之后会调用该Block</span></span><br><span class="line">        </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="NSOperation"><a href="#NSOperation" class="headerlink" title="NSOperation"></a>NSOperation</h2><p>需要和NSOperationQueue配合使用来实现多线程方案</p>
<ul>
<li>添加任务依赖</li>
<li><strong>任务执行状态控制</strong>：<ul>
<li>isReady</li>
<li>isExecuting</li>
<li>isFinished</li>
<li>isCancelled</li>
</ul>
</li>
</ul>
<p>如果只重写了<strong>main</strong>方法，底层控制变更任务执行完成状态，以及任务退出</p>
<p>如果重写了<strong>start</strong>方法，自行控制任务状态</p>
<ul>
<li>最大并发量</li>
</ul>
<h2 id="NSThread"><a href="#NSThread" class="headerlink" title="NSThread"></a>NSThread</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/NSThread.png" alt="NSThread"></p>
<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><h3 id="synchronized"><a href="#synchronized" class="headerlink" title="@synchronized"></a>@synchronized</h3><p>一般在创建单例对象的时候使用</p>
<h3 id="automic"><a href="#automic" class="headerlink" title="automic"></a>automic</h3><p>修饰属性的关键字，对被修饰对象进行原子操作（不负责使用）</p>
<h3 id="OSSpinLock"><a href="#OSSpinLock" class="headerlink" title="OSSpinLock"></a>OSSpinLock</h3><p>自旋锁</p>
<ul>
<li><strong>循环等待</strong>询问，不释放当前资源</li>
<li>用于轻量级访问，简单的int值+1/-1操作</li>
</ul>
<h3 id="NSLock"><a href="#NSLock" class="headerlink" title="NSLock"></a>NSLock</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/NSLock%E6%AD%BB%E9%94%81.png" alt="NSLock死锁"></p>
<h3 id="NSRecursiveLock"><a href="#NSRecursiveLock" class="headerlink" title="NSRecursiveLock"></a>NSRecursiveLock</h3><p>递归锁，可以重入</p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/NSRecursiveLock.png" alt="NSRecursiveLock"></p>
<h3 id="dispatch-semaphore-t"><a href="#dispatch-semaphore-t" class="headerlink" title="dispatch_semaphore_t"></a>dispatch_semaphore_t</h3><p>信号量</p>
<ul>
<li><strong>dispatch_semaphore_create</strong>(1)</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> semaphore &#123;</span><br><span class="line">	<span class="keyword">int</span> value;</span><br><span class="line">	List&lt;Thread&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>dispatch_semaphore_wait</strong>(semaphore, DISPATCH_TIME_FOREVER)</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dispatch_semaphore_wait () &#123;</span><br><span class="line">	S.value = S.value - <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> S.value &lt; <span class="number">0</span> then Block(S.List);<span class="comment">// 阻塞是一个主动行为</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>dispatch_semaphore_signal</strong>(semaphore);</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dispatch_semaphore_signal () &#123;</span><br><span class="line">	S.value = S.value + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> S.value &lt;= <span class="number">0</span> then wakeup(S.List);<span class="comment">// 唤醒是一个被动行为</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="RunLoop"><a href="#RunLoop" class="headerlink" title="RunLoop"></a>RunLoop</h1><blockquote>
<p>Runloop是通过内部维护的<strong>事件循环</strong>来对<strong>事件/消息进行管理</strong>的一个对象</p>
</blockquote>
<ul>
<li>没有消息需要处理时，休眠以避免资源占用</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/RunLoop-1.png" alt="RunLoop-1"></p>
<ul>
<li>有消息需要处理时，立刻被唤醒</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/RunLoop-2.png" alt="RunLoop-2"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/RunLoop2.png" alt="RunLoop2"></p>
<h2 id="数据结构-1"><a href="#数据结构-1" class="headerlink" title="数据结构"></a>数据结构</h2><p>NSRunLoop是CFRunLoop的封装，提供了面向对象的API</p>
<h3 id="CFRunLoop"><a href="#CFRunLoop" class="headerlink" title="CFRunLoop"></a>CFRunLoop</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/CFRunLoop.png" alt="CFRunLoop"></p>
<h3 id="CFRunLoopMode"><a href="#CFRunLoopMode" class="headerlink" title="CFRunLoopMode"></a>CFRunLoopMode</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/CFRunLoopMode.png" alt="CFRunLoopMode"></p>
<h3 id="CFRunLoopSource"><a href="#CFRunLoopSource" class="headerlink" title="CFRunLoopSource"></a>CFRunLoopSource</h3><ul>
<li>source0：需要手动唤醒线程</li>
<li>source1：<strong>具备唤醒线程能力</strong></li>
</ul>
<h3 id="CFRunLoopSource-1"><a href="#CFRunLoopSource-1" class="headerlink" title="CFRunLoopSource"></a>CFRunLoopSource</h3><p>和NSTimer是toll-free bridge的</p>
<h3 id="CFRunLoopObserver"><a href="#CFRunLoopObserver" class="headerlink" title="CFRunLoopObserver"></a>CFRunLoopObserver</h3><p>观测时间点：</p>
<ul>
<li>kCFRunLoopEntry</li>
<li>kCFRunLoopBeforeTimers</li>
<li>kCFRunLoopBeforeSources</li>
<li>kCFRunLoopBeforeWaiting</li>
<li>kCFRunLoopAfterWaiting</li>
<li>kCFRunLoopExit</li>
</ul>
<h3 id="各个数据结构之间的关系"><a href="#各个数据结构之间的关系" class="headerlink" title="各个数据结构之间的关系"></a>各个数据结构之间的关系</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/RunLoop3.png" alt="RunLoop3"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/RunLoop4.png" alt="RunLoop4"></p>
<h3 id="CommonMode的特性"><a href="#CommonMode的特性" class="headerlink" title="CommonMode的特性"></a>CommonMode的特性</h3><ul>
<li>CommonMode<strong>不是一个实际存在</strong>的Mode</li>
<li>是同步Source/Timer/Observer到多个Mode中的<strong>一种技术方案</strong></li>
</ul>
<h3 id="事件循环的实现机制"><a href="#事件循环的实现机制" class="headerlink" title="事件循环的实现机制"></a>事件循环的实现机制</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF.png" alt="事件循环"></p>
<h3 id="RunLoop的核心"><a href="#RunLoop的核心" class="headerlink" title="RunLoop的核心"></a>RunLoop的核心</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/RunLoop%E6%A0%B8%E5%BF%83.png" alt="RunLoop核心"></p>
<h3 id="RunLoop与NSTimer"><a href="#RunLoop与NSTimer" class="headerlink" title="RunLoop与NSTimer"></a>RunLoop与NSTimer</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CFRunLoopAddTimer</span>(runloop, timer, commonMode)</span><br></pre></td></tr></table></figure>
<h3 id="RunLoop与多线程"><a href="#RunLoop与多线程" class="headerlink" title="RunLoop与多线程"></a>RunLoop与多线程</h3><p>线程是和RunLoop一一对应的<br>自己创建的线程默认是没有RunLoop的</p>
<p><strong>怎样实现一个常驻线程？</strong></p>
<ul>
<li>为当前线程开启一个RunLoop（CFRunLoopGetCurrent函数会在第一次调用时为当前线程创建一个RunLoop）</li>
<li>向RunLoop中添加一个Port/Source等维持RunLoop的事件循环</li>
<li>启动该RunLoop</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个Source</span></span><br><span class="line"><span class="built_in">CFRunLoopSourceContext</span> context = &#123;<span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line"><span class="built_in">CFRunLoopSourceRef</span> source = <span class="built_in">CFRunLoopSourceCreate</span>(kCFAllocatorDefault, <span class="number">0</span>, &amp;context);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 创建RunLoop，同时向RunLoop的DefaultMode下面添加Source</span></span><br><span class="line"><span class="built_in">CFRunLoopAddSource</span>(<span class="built_in">CFRunLoopGetCurrent</span>(), source, kCFRunLoopDefaultMode);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 如果可以运行</span></span><br><span class="line"><span class="keyword">while</span> (runAlways) &#123;</span><br><span class="line">	<span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">		<span class="comment">// 令当前RunLoop运行在DefaultMode下面</span></span><br><span class="line">		<span class="built_in">CFRunLoopRunInMode</span>(kCFRunLoopDefaultMode, <span class="number">1.0e10</span>, <span class="literal">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 某一时机 静态变量runAlways = NO时 可以保证跳出RunLoop，线程退出</span></span><br><span class="line"><span class="built_in">CFRunLoopRemoveSource</span>(<span class="built_in">CFRunLoopGetCurrent</span>(), source, kCFRunLoopDefaultMode);</span><br><span class="line"><span class="built_in">CFRelease</span>(source);</span><br></pre></td></tr></table></figure>
<h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><blockquote>
<p>HTTP（HyperText Transfer Protocol），即超文本传输协议。</p>
</blockquote>
<h3 id="请求报文"><a href="#请求报文" class="headerlink" title="请求报文"></a>请求报文</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87.png" alt="请求报文"></p>
<h3 id="响应报文"><a href="#响应报文" class="headerlink" title="响应报文"></a>响应报文</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87.png" alt="响应报文"></p>
<h3 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h3><ul>
<li><code>GET</code></li>
<li><code>POST</code></li>
<li><code>HEAD</code></li>
<li><code>PUT</code></li>
<li><code>DELETE</code></li>
<li><code>OPTION</code></li>
</ul>
<h3 id="GET和POST的区别"><a href="#GET和POST的区别" class="headerlink" title="GET和POST的区别"></a>GET和POST的区别</h3><ul>
<li><code>GET</code>请求参数以?分割拼接到URL后面，<code>POST</code>请求参数在Body里面</li>
<li><code>GET</code>参数长度限制2048个字符，<code>POST</code>一般没有该限制</li>
<li><code>GET</code>请求不安全，<code>POST</code>请求比较安全</li>
</ul>
<p><strong>从语义的角度来回答</strong></p>
<ul>
<li><code>GET</code>：获取资源<ul>
<li>安全的</li>
<li>幂等的</li>
<li>可缓存的</li>
</ul>
</li>
<li><p><code>POST</code>：处理资源</p>
<ul>
<li>非安全的</li>
<li>非幂等的</li>
<li>不可缓存的   </li>
</ul>
</li>
<li><p>安全性：不引起Server端的任何状态变化（<code>GET</code>、<code>HEAD</code>、<code>OPTION</code>）</p>
</li>
<li>幂等性：同一个请求方法执行多次和执行一次的效果完全相同（<code>PUT</code>、<code>DELETE</code>）</li>
<li>可缓存性：请求是否可以被缓存（<code>GET</code>、<code>HEAD</code>）</li>
</ul>
<h3 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h3><ul>
<li>1xx：信息，服务器收到请求，需要请求者继续执行操作</li>
<li>2xx：成功，操作被成功接收并处理<ul>
<li>200：请求成功。一般用于GET与POST请求</li>
</ul>
</li>
<li>3xx：重定向，需要进一步的操作以完成请求<ul>
<li>301：永久移动。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替</li>
</ul>
</li>
<li>4xx：客户端错误，请求包含语法错误或无法完成请求<ul>
<li>401：请求要求用户的身份认证</li>
<li>404：服务器无法根据客户端的请求找到资源（网页）</li>
</ul>
</li>
<li>5xx：服务器错误，服务器在处理请求的过程中发生了错误<ul>
<li>500：服务器内部错误，无法完成请求</li>
</ul>
</li>
</ul>
<h3 id="HTTP连接"><a href="#HTTP连接" class="headerlink" title="HTTP连接"></a>HTTP连接</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/HTTP%E8%BF%9E%E6%8E%A5.png" alt="HTTP连接"></p>
<h3 id="HTTP的特点"><a href="#HTTP的特点" class="headerlink" title="HTTP的特点"></a>HTTP的特点</h3><ul>
<li>无连接（HTTP的持久连接）</li>
<li>无状态（Cookie/Session）</li>
</ul>
<h3 id="持久连接"><a href="#持久连接" class="headerlink" title="持久连接"></a>持久连接</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E6%8C%81%E4%B9%85%E8%BF%9E%E6%8E%A5.png" alt="持久连接"></p>
<p>头部字段</p>
<ul>
<li>Connection：keep-alive</li>
<li>time：20</li>
<li>max：10</li>
</ul>
<p>怎样判断一个连接是否结束？</p>
<ul>
<li><strong>Content-length</strong>：1024</li>
<li><strong>chunked</strong>，最后会有一个空的chunked</li>
</ul>
<h3 id="HTTP抓包"><a href="#HTTP抓包" class="headerlink" title="HTTP抓包"></a>HTTP抓包</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/HTTP%E6%8A%93%E5%8C%85.png" alt="HTTP抓包"></p>
<h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>HTTPS = HTTP + SSL/TLS</p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/HTTPS.png" alt="HTTPS"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/HTTPS2.png" alt="HTTPS2"></p>
<h3 id="HTTPS与网络安全"><a href="#HTTPS与网络安全" class="headerlink" title="HTTPS与网络安全"></a>HTTPS与网络安全</h3><p>会话秘钥 = random S + random C + 预主秘钥</p>
<ul>
<li>连接建立过程使用<strong>非对称加密</strong>，非对称加密很<strong>耗时</strong>的</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86.png" alt="非对称加密"></p>
<ul>
<li>后续通信过程使用<strong>对称加密</strong></li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86.png" alt="对称加密"></p>
<h2 id="UDP（用户数据报协议）"><a href="#UDP（用户数据报协议）" class="headerlink" title="UDP（用户数据报协议）"></a>UDP（用户数据报协议）</h2><h3 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h3><ul>
<li>无连接</li>
<li>尽最大努力交付</li>
<li>面向报文（既不合并，也不拆分）</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E9%9D%A2%E5%90%91%E6%8A%A5%E6%96%87.png" alt="面向报文"></p>
<h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><ul>
<li>复用、分用</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%A4%8D%E7%94%A8%E5%88%86%E7%94%A8.png" alt="复用分用"></p>
<h2 id="TCP（传输控制协议）"><a href="#TCP（传输控制协议）" class="headerlink" title="TCP（传输控制协议）"></a>TCP（传输控制协议）</h2><h3 id="面向连接"><a href="#面向连接" class="headerlink" title="面向连接"></a>面向连接</h3><ul>
<li>数据传输开始之前，需要建立连接（三次握手）</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png" alt="三次握手"></p>
<ul>
<li>数据传输结束之后，需要释放连接（四次挥手）</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.png" alt="四次挥手"></p>
<h3 id="可靠传输"><a href="#可靠传输" class="headerlink" title="可靠传输"></a>可靠传输</h3><ul>
<li>无差错</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E6%97%A0%E5%B7%AE%E9%94%99.png" alt="无差错"></p>
<ul>
<li>不丢失</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0.png" alt="超时重传"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E7%A1%AE%E8%AE%A4%E4%B8%A2%E5%A4%B1.png" alt="确认丢失"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E7%A1%AE%E8%AE%A4%E8%BF%9F%E5%88%B0.png" alt="确认迟到"></p>
<ul>
<li>不重复</li>
<li>按序到达</li>
</ul>
<h3 id="面向字节流"><a href="#面向字节流" class="headerlink" title="面向字节流"></a>面向字节流</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E9%9D%A2%E5%90%91%E5%AD%97%E8%8A%82%E6%B5%81.png" alt="面向字节流"></p>
<h3 id="流量控制"><a href="#流量控制" class="headerlink" title="流量控制"></a>流量控制</h3><p>滑动窗口协议</p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3.png" alt="滑动窗口"></p>
<h3 id="拥塞控制"><a href="#拥塞控制" class="headerlink" title="拥塞控制"></a>拥塞控制</h3><ul>
<li><strong>慢开始，拥塞避免</strong></li>
<li>快恢复，快重传</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6.png" alt="拥塞控制"></p>
<h2 id="DNS解析"><a href="#DNS解析" class="headerlink" title="DNS解析"></a>DNS解析</h2><p>域名到IP地址的映射，DNS解析请求采用UDP数据报，且明文</p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/DNS%E8%A7%A3%E6%9E%90.png" alt="DNS解析"></p>
<h3 id="递归查询"><a href="#递归查询" class="headerlink" title="递归查询"></a>递归查询</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/DNS%E8%A7%A3%E6%9E%902.png" alt="DNS解析2"></p>
<h3 id="迭代查询"><a href="#迭代查询" class="headerlink" title="迭代查询"></a>迭代查询</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/DNS%E8%A7%A3%E6%9E%903.png" alt="DNS解析3"></p>
<h3 id="DNS劫持"><a href="#DNS劫持" class="headerlink" title="DNS劫持"></a>DNS劫持</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/DNS%E5%8A%AB%E6%8C%81.png" alt="DNS劫持"></p>
<p>DNS劫持和HTTP是没有关系的</p>
<ul>
<li>DNS解析发生在HTTP建立连接之前</li>
<li>DNS解析请求使用UDP数据报，端口号是53</li>
</ul>
<h3 id="DNS解析转发"><a href="#DNS解析转发" class="headerlink" title="DNS解析转发"></a>DNS解析转发</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/DNS%E8%A7%A3%E6%9E%90%E8%BD%AC%E5%8F%91.png" alt="DNS解析转发"></p>
<h3 id="httpDNS"><a href="#httpDNS" class="headerlink" title="httpDNS"></a>httpDNS</h3><p>使用HTTP协议向DNS服务器的80端口进行请求</p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/httpDNS.png" alt="httpDNS"></p>
<h3 id="长连接"><a href="#长连接" class="headerlink" title="长连接"></a>长连接</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E9%95%BF%E8%BF%9E%E6%8E%A5.png" alt="长连接"></p>
<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>Cookie主要用来记录用户状态，区分用户；<strong>状态保存在客户端</strong></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/Cookie.png" alt="Cookie"></p>
<h3 id="删除Cookie"><a href="#删除Cookie" class="headerlink" title="删除Cookie"></a>删除Cookie</h3><ul>
<li>新cookie覆盖旧cookie</li>
<li>覆盖规则：name、path、domain等需要与原cookie一致</li>
<li>设置cookie的<strong>expire=过去的一个时间点</strong>，或者<strong>maxAge=0</strong></li>
</ul>
<h3 id="Cookie安全"><a href="#Cookie安全" class="headerlink" title="Cookie安全"></a>Cookie安全</h3><ul>
<li>对Cookie进行加密处理</li>
<li>只在https上携带Cookie</li>
<li>设置Cookie的httpOnly，防止跨站脚本攻击</li>
</ul>
<h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p>Session也是用来记录用户状态，区分用户的；<strong>状态存放在服务器</strong></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/Session.png" alt="Session"></p>
<h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><h2 id="六大设计原则"><a href="#六大设计原则" class="headerlink" title="六大设计原则"></a>六大设计原则</h2><ul>
<li>单一职责原则<ul>
<li>一个类只负责一件事</li>
</ul>
</li>
<li>开闭原则<ul>
<li>对修改关闭，对扩展开放</li>
</ul>
</li>
<li>接口隔离原则<ul>
<li>使用多个专门的协议，而不是一个庞大臃肿的协议</li>
<li>协议中的方法应当尽量少</li>
</ul>
</li>
<li>依赖倒置原则<ul>
<li>抽象不应该依赖于具体实现，具体实现可以依赖于抽象</li>
</ul>
</li>
<li>里氏替换原则<ul>
<li>父类可以被子类无缝替换，且原有功能不受任何影响</li>
</ul>
</li>
<li>迪米特法则<ul>
<li>一个对象应当对其他对象有尽可能少的了解</li>
<li>高内聚，低耦合</li>
</ul>
</li>
</ul>
<h2 id="责任链"><a href="#责任链" class="headerlink" title="责任链"></a>责任链</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E8%B4%A3%E4%BB%BB%E9%93%BE.png" alt="责任链"></p>
<h2 id="桥接"><a href="#桥接" class="headerlink" title="桥接"></a>桥接</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E6%A1%A5%E6%8E%A5.png" alt="桥接"></p>
<h2 id="适配器"><a href="#适配器" class="headerlink" title="适配器"></a>适配器</h2><p>一个现有类需要适应变化的问题</p>
<ul>
<li><strong>对象适配器</strong></li>
<li>类适配器</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E9%80%82%E9%85%8D%E5%99%A8.png" alt="适配器"></p>
<h2 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h2><h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><ul>
<li>行为参数化</li>
<li><strong>降低代码重合度</strong></li>
</ul>
<h1 id="架构-框架"><a href="#架构-框架" class="headerlink" title="架构/框架"></a>架构/框架</h1><ul>
<li>模块化</li>
<li>分层</li>
<li>解耦</li>
<li>降低代码重合度</li>
</ul>
<h2 id="图片缓存"><a href="#图片缓存" class="headerlink" title="图片缓存"></a>图片缓存</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%98.png" alt="图片缓存"></p>
<h3 id="内存设计"><a href="#内存设计" class="headerlink" title="内存设计"></a>内存设计</h3><ul>
<li>以图片URL的单向Hash值作为Key</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%982.png" alt="图片缓存2"></p>
<ul>
<li>存储的Size</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%983.png" alt="图片缓存3"></p>
<ul>
<li>淘汰策略<ul>
<li>以队列先进先出的方式淘汰</li>
<li>LRU算法（如30分钟内是否使用过）</li>
</ul>
</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%984.png" alt="图片缓存4"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%985.png" alt="图片缓存5"></p>
<h3 id="磁盘设计"><a href="#磁盘设计" class="headerlink" title="磁盘设计"></a>磁盘设计</h3><ul>
<li>存储方式</li>
<li>大小限制（如100MB）</li>
<li>淘汰策略（如某一图片存储时间距今已超过7天）</li>
</ul>
<h3 id="网络设计"><a href="#网络设计" class="headerlink" title="网络设计"></a>网络设计</h3><ul>
<li>图片请求最大并发量</li>
<li>请求超时策略</li>
<li>请求优先级</li>
</ul>
<h3 id="图片解码"><a href="#图片解码" class="headerlink" title="图片解码"></a>图片解码</h3><ul>
<li>应用策略模式对不同图片格式进行解码</li>
<li>在哪个阶段做图片解码处理<ul>
<li>磁盘读取后</li>
<li>网络请求返回后 </li>
</ul>
</li>
</ul>
<h3 id="线程处理"><a href="#线程处理" class="headerlink" title="线程处理"></a>线程处理</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%986.png" alt="图片缓存6"></p>
<h2 id="阅读时长统计"><a href="#阅读时长统计" class="headerlink" title="阅读时长统计"></a>阅读时长统计</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E9%98%85%E8%AF%BB%E6%97%B6%E9%95%BF%E7%BB%9F%E8%AE%A1.png" alt="阅读时长统计"></p>
<h3 id="记录器"><a href="#记录器" class="headerlink" title="记录器"></a>记录器</h3><ul>
<li>基于不同分类场景提供的关于记录的封装、适配</li>
</ul>
<h3 id="记录的缓存-amp-存储"><a href="#记录的缓存-amp-存储" class="headerlink" title="记录的缓存 &amp; 存储"></a>记录的缓存 &amp; 存储</h3><ul>
<li>定时写磁盘</li>
<li>限定内存缓存条数（如10条），超过该条数，即写磁盘</li>
</ul>
<h3 id="记录上传器"><a href="#记录上传器" class="headerlink" title="记录上传器"></a>记录上传器</h3><p>延迟上传场景：</p>
<ul>
<li>前后台切换</li>
<li>从无网到有网的变化</li>
<li>通用轻量接口捎带</li>
</ul>
<p>上传时机把控</p>
<ul>
<li>立刻上传</li>
<li>延时上传</li>
<li>定时上传</li>
</ul>
<h2 id="复杂页面框架"><a href="#复杂页面框架" class="headerlink" title="复杂页面框架"></a>复杂页面框架</h2><h3 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/MVVM.png" alt="MVVM"></p>
<h3 id="RN数据流思想"><a href="#RN数据流思想" class="headerlink" title="RN数据流思想"></a>RN数据流思想</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/RN.png" alt="RN"></p>
<h3 id="客户端整体架构"><a href="#客户端整体架构" class="headerlink" title="客户端整体架构"></a>客户端整体架构</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84.png" alt="客户端整体架构"></p>
<p>业务之间的解耦通信方式</p>
<ul>
<li>OpenURL</li>
<li><strong>依赖注入</strong></li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5.png" alt="依赖注入"></p>
<h1 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h1><h2 id="字符串反转"><a href="#字符串反转" class="headerlink" title="字符串反转"></a>字符串反转</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%8D%E8%BD%AC.png" alt="字符串反转"></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> char_reverse(<span class="keyword">char</span>* cha)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 指向第一个字符</span></span><br><span class="line">    <span class="keyword">char</span>* begin = cha;</span><br><span class="line">    <span class="comment">// 指向最后一个字符</span></span><br><span class="line">    <span class="keyword">char</span>* end = cha + strlen(cha) - <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (begin &lt; end) &#123;</span><br><span class="line">        <span class="comment">// 交换前后两个字符,同时移动指针</span></span><br><span class="line">        <span class="keyword">char</span> temp = *begin;</span><br><span class="line">        *(begin++) = *end;</span><br><span class="line">        *(end--) = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="单链表反转"><a href="#单链表反转" class="headerlink" title="单链表反转"></a>单链表反转</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E9%93%BE%E8%A1%A8%E5%8F%8D%E8%BD%AC.png" alt="单链表反转"></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> Node* reverseList(<span class="keyword">struct</span> Node *head)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义遍历指针，初始化为头结点</span></span><br><span class="line">    <span class="keyword">struct</span> Node *p = head;</span><br><span class="line">    <span class="comment">// 反转后的链表头部</span></span><br><span class="line">    <span class="keyword">struct</span> Node *newH = <span class="literal">NULL</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历链表</span></span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 记录下一个结点</span></span><br><span class="line">        <span class="keyword">struct</span> Node *temp = p-&gt;next;</span><br><span class="line">        <span class="comment">// 当前结点的next指向新链表头部</span></span><br><span class="line">        p-&gt;next = newH;</span><br><span class="line">        <span class="comment">// 更改新链表头部为当前结点</span></span><br><span class="line">        newH = p;</span><br><span class="line">        <span class="comment">// 移动p指针</span></span><br><span class="line">        p = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 返回反转后的链表头结点</span></span><br><span class="line">    <span class="keyword">return</span> newH;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Node* constructList(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 头结点定义</span></span><br><span class="line">    <span class="keyword">struct</span> Node *head = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="comment">// 记录当前尾结点</span></span><br><span class="line">    <span class="keyword">struct</span> Node *cur = <span class="literal">NULL</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">struct</span> Node *node = malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> Node));</span><br><span class="line">        node-&gt;data = i;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 头结点为空，新结点即为头结点</span></span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            head = node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 当前结点的next为新结点</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            cur-&gt;next = node;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置当前结点为新结点</span></span><br><span class="line">        cur = node;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> printList(<span class="keyword">struct</span> Node *head)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> Node* temp = head;</span><br><span class="line">    <span class="keyword">while</span> (temp != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        printf(<span class="string">"node is %d \n"</span>, temp-&gt;data);</span><br><span class="line">        temp = temp-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="有序数组归并"><a href="#有序数组归并" class="headerlink" title="有序数组归并"></a>有序数组归并</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E5%BD%92%E5%B9%B6.png" alt="有序数组归并"></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> mergeList(<span class="keyword">int</span> a[], <span class="keyword">int</span> aLen, <span class="keyword">int</span> b[], <span class="keyword">int</span> bLen, <span class="keyword">int</span> result[])</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> p = <span class="number">0</span>; <span class="comment">// 遍历数组a的指针</span></span><br><span class="line">    <span class="keyword">int</span> q = <span class="number">0</span>; <span class="comment">// 遍历数组b的指针</span></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>; <span class="comment">// 记录当前存储位置</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 任一数组没有到达边界则进行遍历</span></span><br><span class="line">    <span class="keyword">while</span> (p &lt; aLen &amp;&amp; q &lt; bLen) &#123;</span><br><span class="line">        <span class="comment">// 如果a数组对应位置的值小于b数组对应位置的值</span></span><br><span class="line">        <span class="keyword">if</span> (a[p] &lt;= b[q]) &#123;</span><br><span class="line">            <span class="comment">// 存储a数组的值</span></span><br><span class="line">            result[i] = a[p];</span><br><span class="line">            <span class="comment">// 移动a数组的遍历指针</span></span><br><span class="line">            p++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 存储b数组的值</span></span><br><span class="line">            result[i] = b[q];</span><br><span class="line">            <span class="comment">// 移动b数组的遍历指针</span></span><br><span class="line">            q++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 指向合并结果的下一个存储位置</span></span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果a数组有剩余</span></span><br><span class="line">    <span class="keyword">while</span> (p &lt; aLen) &#123;</span><br><span class="line">        <span class="comment">// 将a数组剩余部分拼接到合并结果的后面</span></span><br><span class="line">        result[i] = a[p++];</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果b数组有剩余</span></span><br><span class="line">    <span class="keyword">while</span> (q &lt; bLen) &#123;</span><br><span class="line">        <span class="comment">// 将b数组剩余部分拼接到合并结果的后面</span></span><br><span class="line">        result[i] = b[q++];</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h2><p><strong>在一个字符串中找到第一个只出现一次的字符</strong></p>
<p>字符char是一个长度为8的数据类型，因此总共有256中可能。每个字母根据其ASCII码值作为数组的下标对应数组的一个数字。数组中存储的是每个字符出现的次数。</p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%93%88%E5%B8%8C%E8%A1%A8.png" alt="哈希表"></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> findFirstChar(<span class="keyword">char</span>* cha)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">char</span> result = <span class="string">'\0'</span>;</span><br><span class="line">    <span class="comment">// 定义一个数组 用来存储各个字母出现次数</span></span><br><span class="line">    <span class="keyword">int</span> array[<span class="number">256</span>];</span><br><span class="line">    <span class="comment">// 对数组进行初始化操作</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++) &#123;</span><br><span class="line">        array[i] =<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 定义一个指针 指向当前字符串头部</span></span><br><span class="line">    <span class="keyword">char</span>* p = cha;</span><br><span class="line">    <span class="comment">// 遍历每个字符</span></span><br><span class="line">    <span class="keyword">while</span> (*p != <span class="string">'\0'</span>) &#123;</span><br><span class="line">        <span class="comment">// 在字母对应存储位置 进行出现次数+1操作</span></span><br><span class="line">        array[*(p++)]++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将P指针重新指向字符串头部</span></span><br><span class="line">    p = cha;</span><br><span class="line">    <span class="comment">// 遍历每个字母的出现次数</span></span><br><span class="line">    <span class="keyword">while</span> (*p != <span class="string">'\0'</span>) &#123;</span><br><span class="line">        <span class="comment">// 遇到第一个出现次数为1的字符，打印结果</span></span><br><span class="line">        <span class="keyword">if</span> (array[*p] == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            result = *p;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 反之继续向后遍历</span></span><br><span class="line">        p++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="共同父视图"><a href="#共同父视图" class="headerlink" title="共同父视图"></a>共同父视图</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%85%B1%E5%90%8C%E7%88%B6%E8%A7%86%E5%9B%BE.png" alt="共同父视图"></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSArray</span> &lt;<span class="built_in">UIView</span> *&gt; *)findCommonSuperView:(<span class="built_in">UIView</span> *)viewOne other:(<span class="built_in">UIView</span> *)viewOther</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *result = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查找第一个视图的所有父视图</span></span><br><span class="line">    <span class="built_in">NSArray</span> *arrayOne = [<span class="keyword">self</span> findSuperViews:viewOne];</span><br><span class="line">    <span class="comment">// 查找第二个视图的所有父视图</span></span><br><span class="line">    <span class="built_in">NSArray</span> *arrayOther = [<span class="keyword">self</span> findSuperViews:viewOther];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 越界限制条件</span></span><br><span class="line">    <span class="keyword">while</span> (i &lt; MIN((<span class="keyword">int</span>)arrayOne.count, (<span class="keyword">int</span>)arrayOther.count)) &#123;</span><br><span class="line">        <span class="comment">// 倒序方式获取各个视图的父视图</span></span><br><span class="line">        <span class="built_in">UIView</span> *superOne = [arrayOne objectAtIndex:arrayOne.count - i - <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">UIView</span> *superOther = [arrayOther objectAtIndex:arrayOther.count - i - <span class="number">1</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 比较如果相等 则为共同父视图</span></span><br><span class="line">        <span class="keyword">if</span> (superOne == superOther) &#123;</span><br><span class="line">            [result addObject:superOne];</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果不相等，则结束遍历</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSArray</span> &lt;<span class="built_in">UIView</span> *&gt; *)findSuperViews:(<span class="built_in">UIView</span> *)view</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 初始化为第一父视图</span></span><br><span class="line">    <span class="built_in">UIView</span> *temp = view.superview;</span><br><span class="line">    <span class="comment">// 保存结果的数组</span></span><br><span class="line">    <span class="built_in">NSMutableArray</span> *result = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    <span class="keyword">while</span> (temp) &#123;</span><br><span class="line">        [result addObject:temp];</span><br><span class="line">        <span class="comment">// 顺着superview指针一直向上查找</span></span><br><span class="line">        temp = temp.superview;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="无效数组职工查找中位数"><a href="#无效数组职工查找中位数" class="headerlink" title="无效数组职工查找中位数"></a>无效数组职工查找中位数</h2><ul>
<li>排序算法+中位数</li>
<li><strong>利用快排思想（分治思想）</strong></li>
</ul>
<h3 id="排序算法"><a href="#排序算法" class="headerlink" title="排序算法"></a>排序算法</h3><ul>
<li>冒泡排序</li>
<li>快速排序</li>
<li>堆排序</li>
<li>……</li>
</ul>
<h3 id="中位数"><a href="#中位数" class="headerlink" title="中位数"></a>中位数</h3><ul>
<li>当n为奇数时，(n+1)/2</li>
<li>当n为偶数时，(n/2+(n/2+1))/2</li>
</ul>
<h3 id="快排思想"><a href="#快排思想" class="headerlink" title="快排思想"></a>快排思想</h3><p>选取关键字，高低交替扫描</p>
<ul>
<li>任意挑一个元素，以该元素为支点，划分集合为两部分。</li>
<li>如果左侧集合长度恰为(n-1)/2，那么支点恰为中位数。</li>
<li>如果左侧长度&lt;(n-1)/2，那么中位点在右侧；反之，中位数在左侧。</li>
<li>进入相应的一侧继续寻找中位点。</li>
</ul>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/%E5%BF%AB%E6%8E%92%E6%80%9D%E6%83%B3.png" alt="快排思想"></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> findMedian(<span class="keyword">int</span> a[], <span class="keyword">int</span> aLen)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> low = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> high = aLen - <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> mid = (aLen - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> div = PartSort(a, low, high);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (div != mid)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (mid &lt; div)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//左半区间找</span></span><br><span class="line">            div = PartSort(a, low, div - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//右半区间找</span></span><br><span class="line">            div = PartSort(a, div + <span class="number">1</span>, high);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//找到了</span></span><br><span class="line">    <span class="keyword">return</span> a[mid];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> PartSort(<span class="keyword">int</span> a[], <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> low = start;</span><br><span class="line">    <span class="keyword">int</span> high = end;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//选取关键字</span></span><br><span class="line">    <span class="keyword">int</span> key = a[end];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (low &lt; high)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//左边找比key大的值</span></span><br><span class="line">        <span class="keyword">while</span> (low &lt; high &amp;&amp; a[low] &lt;= key)</span><br><span class="line">        &#123;</span><br><span class="line">            ++low;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//右边找比key小的值</span></span><br><span class="line">        <span class="keyword">while</span> (low &lt; high &amp;&amp; a[high] &gt;= key)</span><br><span class="line">        &#123;</span><br><span class="line">            --high;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (low &lt; high)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//找到之后交换左右的值</span></span><br><span class="line">            <span class="keyword">int</span> temp = a[low];</span><br><span class="line">            a[low] = a[high];</span><br><span class="line">            a[high] = temp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> temp = a[high];</span><br><span class="line">    a[high] = a[end];</span><br><span class="line">    a[end] = temp;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> low;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="第三方"><a href="#第三方" class="headerlink" title="第三方"></a>第三方</h1><h2 id="AFNetworking"><a href="#AFNetworking" class="headerlink" title="AFNetworking"></a>AFNetworking</h2><h3 id="框架图"><a href="#框架图" class="headerlink" title="框架图"></a>框架图</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/AFNetworking.png" alt="AFNetworking"></p>
<h3 id="类关系图"><a href="#类关系图" class="headerlink" title="类关系图"></a>类关系图</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/AFNetworking2.png" alt="AFNetworking2"></p>
<h3 id="AFURLSessionManager"><a href="#AFURLSessionManager" class="headerlink" title="AFURLSessionManager"></a>AFURLSessionManager</h3><ul>
<li>创建和管理NSURLSession、NSURLSessionTask</li>
<li>实现NSURLSessionDelegate等协议的代理方法</li>
<li>引入AFSecurityPolicy保证请求安全</li>
<li>引入AFNetworkReachabilityManager监控网络状态</li>
</ul>
<h2 id="SDWebImage"><a href="#SDWebImage" class="headerlink" title="SDWebImage"></a>SDWebImage</h2><h3 id="框架图-1"><a href="#框架图-1" class="headerlink" title="框架图"></a>框架图</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/SDWebImage.png" alt="SDWebImage"></p>
<h3 id="加载图片流程"><a href="#加载图片流程" class="headerlink" title="加载图片流程"></a>加载图片流程</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/SDWebImage2.png" alt="SDWebImage2"></p>
<h2 id="ReactiveCocoa"><a href="#ReactiveCocoa" class="headerlink" title="ReactiveCocoa"></a>ReactiveCocoa</h2><h3 id="类关系图-1"><a href="#类关系图-1" class="headerlink" title="类关系图"></a>类关系图</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/ReactiveCocoa.png" alt="ReactiveCocoa"></p>
<h3 id="信号"><a href="#信号" class="headerlink" title="信号"></a>信号</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/ReactiveCocoa2.png" alt="ReactiveCocoa2"></p>
<p>信号代表一连串的状态，在状态改变时，RACSubscriber就会收到通知执行相应的命令</p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/ReactiveCocoa3.png" alt="ReactiveCocoa3"></p>
<h3 id="订阅"><a href="#订阅" class="headerlink" title="订阅"></a>订阅</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/ReactiveCocoa4.png" alt="ReactiveCocoa4"></p>
<p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/ReactiveCocoa5.png" alt="ReactiveCocoa5"></p>
<h2 id="AsyncDisplayKit"><a href="#AsyncDisplayKit" class="headerlink" title="AsyncDisplayKit"></a>AsyncDisplayKit</h2><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/AsyncDisplayKit.png" alt="AsyncDisplayKit"></p>
<h3 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h3><p><img src="https://githubblog-1252104787.cos.ap-guangzhou.myqcloud.com/AsyncDisplayKit2.png" alt="AsyncDisplayKit2"></p>
<p>针对ASNode的修改和提交，会对其进行封装并提交到全局容器当中。ASDK也在RunLoop中注册了一个Observer。当RunLoop进入休眠前，ASDK执行该loop内提交的所有任务。</p>
<p><strong>欢迎转载，转载请注明出处：<a href="http://www.huajingzeng.com" target="_blank" rel="noopener">曾华经的博客</a></strong></p>

    </div>
    <p class="post-meta">
        <span class="post-cat">分类：
            <a class="cat-link" href="/categories/编程基础/">编程基础</a>
        </span>
        <span class="post-tags">
            标签：
            
    
        <a href="/tags/iOS/" title="iOS">iOS</a>
    

        </span>
    </p>
</article>
<!-- 分享按钮 -->

  <div class="article-share clearfix text-center">
    <div class="share-area">
      <span class="share-txt">分享到：</span>
      <a href="javascript: window.open('http://service.weibo.com/share/share.php?url=' + encodeURIComponent(location.href) + '&title=' + document.title + '&language=zh_cn');" class="share-icon weibo"></a>
      <a href="javascript: alert('请复制链接到微信并发送');" class="share-icon wechat"></a>
      <!-- <a href="javascript: window.open('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=' + encodeURIComponent(location.href) + '&title=' + document.title);" class="share-icon qqzone"></a> -->
      <a href="javascript: window.open('http://connect.qq.com/widget/shareqq/index.html?url=' + encodeURIComponent(location.href) + '&title=' + document.title + '&callback=' + encodeURIComponent(location.href));" class="share-icon qq"></a>
      <a href="javascript: window.open('http://shuo.douban.com/!service/share?href=' + encodeURIComponent(location.href) + '&name=' + document.title + '&text=' + document.title);" class="share-icon douban"></a>
    </div>
  </div>


<!-- 上一篇/下一篇 -->

<div class="article-nav clearfix">
    
    <span class="prev fl">
        上一篇<br>
        <a href="javascript: void(0);">没有上一篇了</a>
    </span>
    

    
    <span class="next fr">
        下一篇<br>
        <a href="/post/《iOS编程实战》/">
            
                《iOS编程实战》
            
        </a>
    </span>
    
</div>

<!-- 文章评论 -->

  <script src="/js/comment.js"></script>
  <div id="comments" class="comment">
    <!--
    <div class="sign-bar">
      GitHub 已登录!
      <span class="sign-link">登出</span>
    </div>
    <section class="box">
      <div class="com-avatar"><img src="/img/zhj.jpg" alt="avatar"></div>
      <div class="com-text">
        <div class="main">
          <textarea class="text-area-edited show" placeholder="欢迎评论！"></textarea>
          <div class="text-area-preview"></div>
        </div>
        <div class="switch">
          <div class="switch-item on">编辑</div>
          <div class="switch-item">预览</div>
        </div>
        <div class="button">提交</div>
      </div>
    </section>
    <section class="tips">注：评论支持 markdown 语法！</section>
    <section class="list-wrap">
      <ul class="list">
        <li>
          <div class="user-avatar">
            <a href="/">
              <img src="/img/zhj.jpg" alt="user-avatar">
            </a>
          </div>
          <div class="user-comment">
            <div class="user-comment-header">
              <span class="post-name">张德龙</span>
              <span class="post-time">2017年12月12日</span>
              <span class="like liked">已赞</span>
              <span class="like-num">2</span>
            </div>
            <div class="user-comment-body">333333</div>
          </div>
        </li>
        <li>
          <div class="user-avatar">
            <a href="/">
              <img src="/img/zhj.jpg" alt="user-avatar">
            </a>
          </div>
          <div class="user-comment">
            <div class="user-comment-header">
              <span class="post-name">刘德华</span>
              <span class="post-time">2017年12月12日</span>
              <span class="like">点赞</span>
              <span class="like-num">2</span>
            </div>
            <div class="user-comment-body">vvvvv</div>
          </div>
        </li>
      </ul>
      <div class="page-nav">
        <a href="javascript: void(0);" class="item">1</a>
        <a href="javascript: void(0);" class="item">2</a>
        <a href="javascript: void(0);" class="item current">3</a>
      </div>
    </section>
    -->
  </div>
  <script>
  JELON.Comment({
    container: 'comments',
    label: 'iOS知识小集' || 'post/iOS知识小集/',
    owner: 'HuajingZeng',
    repo: 'huajingzeng.github.io_comments',
    clientId: '7ae3915c563a60d41451',
    clientSecret: '2abefe41031e15eabf12a828f30fd380487fb738'
  });
  </script>


            </div>

        </section>
        <!-- 侧栏部分 -->
<aside class="sidebar">
    <section class="widget">
        <h3 class="widget-hd"><strong>文章分类</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
    <li>
        <a href="/categories/程序人生/">程序人生</a>
        <span class="badge">(2)</span>
    </li>
    
    <li>
        <a href="/categories/编程基础/">编程基础</a>
        <span class="badge">(11)</span>
    </li>
    
    <li>
        <a href="/categories/编程基础/开发工具/">开发工具</a>
        <span class="badge">(3)</span>
    </li>
    
</ul>
    </section>

    
    <section class="widget">
        <h3 class="widget-hd"><strong>热门标签</strong></h3>
        <!-- 文章标签 -->
<div class="widget-bd tag-wrap">
  
    <a class="tag-item" href="/tags/随笔/" title="随笔">随笔 (1)</a>
  
    <a class="tag-item" href="/tags/面向对象/" title="面向对象">面向对象 (1)</a>
  
    <a class="tag-item" href="/tags/设计原则/" title="设计原则">设计原则 (1)</a>
  
    <a class="tag-item" href="/tags/设计模式/" title="设计模式">设计模式 (1)</a>
  
    <a class="tag-item" href="/tags/Shell/" title="Shell">Shell (2)</a>
  
    <a class="tag-item" href="/tags/iOS/" title="iOS">iOS (6)</a>
  
    <a class="tag-item" href="/tags/OS-X/" title="OS X">OS X (3)</a>
  
    <a class="tag-item" href="/tags/代码大全/" title="代码大全">代码大全 (1)</a>
  
    <a class="tag-item" href="/tags/核对表/" title="核对表">核对表 (1)</a>
  
    <a class="tag-item" href="/tags/Objective-C/" title="Objective-C">Objective-C (1)</a>
  
    <a class="tag-item" href="/tags/程序员/" title="程序员">程序员 (1)</a>
  
    <a class="tag-item" href="/tags/书籍/" title="书籍">书籍 (1)</a>
  
    <a class="tag-item" href="/tags/正则表达式/" title="正则表达式">正则表达式 (1)</a>
  
    <a class="tag-item" href="/tags/Git/" title="Git">Git (1)</a>
  
    <a class="tag-item" href="/tags/SVN/" title="SVN">SVN (1)</a>
  
    <a class="tag-item" href="/tags/CVS/" title="CVS">CVS (1)</a>
  
</div>
    </section>
    

    

    
    <!-- 友情链接 -->
    <section class="widget">
        <h3 class="widget-hd"><strong>友情链接</strong></h3>
        <!-- 文章分类 -->
<ul class="widget-bd">
    
        <li>
            <a href="https://stackoverflow.com/" target="_blank" title="Stack Overflow">Stack Overflow</a>
        </li>
    
        <li>
            <a href="http://nshipster.cn/" target="_blank" title="NSHipster">NSHipster</a>
        </li>
    
        <li>
            <a href="https://www.raywenderlich.com/" target="_blank" title="raywenderlich">raywenderlich</a>
        </li>
    
        <li>
            <a href="http://www.cocoachina.com/" target="_blank" title="Cocoa China">Cocoa China</a>
        </li>
    
        <li>
            <a href="https://objccn.io/" target="_blank" title="ObjC 中国">ObjC 中国</a>
        </li>
    
        <li>
            <a href="http://mac.orsoon.com/" target="_blank" title="未来软件园">未来软件园</a>
        </li>
    
</ul>
    </section>
    
</aside>
<!-- / 侧栏部分 -->
    </div>

    <!-- 博客底部 -->
    <footer class="footer">
    &copy;
    
        2016-2019
    

    <a href="/">曾华经</a>
	<br>
	<span id="busuanzi_container_site_pv">本站总访问量：<span id="busuanzi_value_site_pv"><i class="fa fa-spinner"></i></span>次</span>
	&emsp;
    <span id="busuanzi_container_site_uv">本站总访客数：<span id="busuanzi_value_site_uv"><i class="fa fa-spinner"></i></span>人</span>
</footer>
<div class="back-to-top" id="JELON__backToTop" title="返回顶部">返回顶部</div>

    <!--博客js脚本 -->
    <!-- 这里放网站js脚本 -->
<script src="/js/main.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>